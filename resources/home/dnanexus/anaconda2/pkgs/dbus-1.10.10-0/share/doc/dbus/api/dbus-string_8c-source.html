<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>D-Bus: dbus-string.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<h1>dbus-string.c</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* -*- mode: C; c-file-style: "gnu"; indent-tabs-mode: nil; -*- */</span>
<a name="l00002"></a>00002 <span class="comment">/* dbus-string.c String utility class (internal to D-Bus implementation)</span>
<a name="l00003"></a>00003 <span class="comment"> * </span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (C) 2002, 2003, 2004, 2005 Red Hat, Inc.</span>
<a name="l00005"></a>00005 <span class="comment"> * Copyright (C) 2006 Ralf Habacker &lt;ralf.habacker@freenet.de&gt;</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * Licensed under the Academic Free License version 2.1</span>
<a name="l00008"></a>00008 <span class="comment"> * </span>
<a name="l00009"></a>00009 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00010"></a>00010 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00011"></a>00011 <span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00012"></a>00012 <span class="comment"> * (at your option) any later version.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00015"></a>00015 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00016"></a>00016 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00017"></a>00017 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00018"></a>00018 <span class="comment"> * </span>
<a name="l00019"></a>00019 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00020"></a>00020 <span class="comment"> * along with this program; if not, write to the Free Software</span>
<a name="l00021"></a>00021 <span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> */</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;config.h&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include "dbus-internals.h"</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include "dbus-string.h"</span>
<a name="l00028"></a>00028 <span class="comment">/* we allow a system header here, for speed/convenience */</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00030"></a>00030 <span class="comment">/* for vsnprintf */</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#define DBUS_CAN_USE_DBUS_STRING_PRIVATE 1</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor">#include "dbus-string-private.h"</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include "dbus-marshal-basic.h"</span> <span class="comment">/* probably should be removed by moving the usage of DBUS_TYPE</span>
<a name="l00035"></a>00035 <span class="comment">                                 * into the marshaling-related files</span>
<a name="l00036"></a>00036 <span class="comment">                                 */</span>
<a name="l00037"></a>00037 <span class="comment">/* for DBUS_VA_COPY */</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include "dbus-sysdeps.h"</span>
<a name="l00039"></a>00039 
<a name="l00078"></a>00078 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00079"></a>00079 fixup_alignment (<a class="code" href="structDBusRealString.html">DBusRealString</a> *real)
<a name="l00080"></a>00080 {
<a name="l00081"></a>00081   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *aligned;
<a name="l00082"></a>00082   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *real_block;
<a name="l00083"></a>00083   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> old_align_offset;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085   <span class="comment">/* we have to have extra space in real-&gt;allocated for the align offset and nul byte */</span>
<a name="l00086"></a>00086   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> &lt;= real-&gt;<a class="code" href="structDBusRealString.html#e12ec58c271e47f3f89fae1410b7c5e5">allocated</a> - _DBUS_STRING_ALLOCATION_PADDING);
<a name="l00087"></a>00087   
<a name="l00088"></a>00088   old_align_offset = real-&gt;<a class="code" href="structDBusRealString.html#21fb373a65e36646787392a3dfe62443">align_offset</a>;
<a name="l00089"></a>00089   real_block = real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> - old_align_offset;
<a name="l00090"></a>00090   
<a name="l00091"></a>00091   aligned = _DBUS_ALIGN_ADDRESS (real_block, 8);
<a name="l00092"></a>00092 
<a name="l00093"></a>00093   real-&gt;<a class="code" href="structDBusRealString.html#21fb373a65e36646787392a3dfe62443">align_offset</a> = aligned - real_block;
<a name="l00094"></a>00094   real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> = aligned;
<a name="l00095"></a>00095   
<a name="l00096"></a>00096   <span class="keywordflow">if</span> (old_align_offset != real-&gt;<a class="code" href="structDBusRealString.html#21fb373a65e36646787392a3dfe62443">align_offset</a>)
<a name="l00097"></a>00097     {
<a name="l00098"></a>00098       <span class="comment">/* Here comes the suck */</span>
<a name="l00099"></a>00099       memmove (real_block + real-&gt;<a class="code" href="structDBusRealString.html#21fb373a65e36646787392a3dfe62443">align_offset</a>,
<a name="l00100"></a>00100                real_block + old_align_offset,
<a name="l00101"></a>00101                real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> + 1);
<a name="l00102"></a>00102     }
<a name="l00103"></a>00103 
<a name="l00104"></a>00104   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (real-&gt;<a class="code" href="structDBusRealString.html#21fb373a65e36646787392a3dfe62443">align_offset</a> &lt; 8);
<a name="l00105"></a>00105   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (_DBUS_ALIGN_ADDRESS (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>, 8) == real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>);
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 
<a name="l00108"></a>00108 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00109"></a>00109 undo_alignment (<a class="code" href="structDBusRealString.html">DBusRealString</a> *real)
<a name="l00110"></a>00110 {
<a name="l00111"></a>00111   <span class="keywordflow">if</span> (real-&gt;<a class="code" href="structDBusRealString.html#21fb373a65e36646787392a3dfe62443">align_offset</a> != 0)
<a name="l00112"></a>00112     {
<a name="l00113"></a>00113       memmove (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> - real-&gt;<a class="code" href="structDBusRealString.html#21fb373a65e36646787392a3dfe62443">align_offset</a>,
<a name="l00114"></a>00114                real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>,
<a name="l00115"></a>00115                real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> + 1);
<a name="l00116"></a>00116 
<a name="l00117"></a>00117       real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> = real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> - real-&gt;<a class="code" href="structDBusRealString.html#21fb373a65e36646787392a3dfe62443">align_offset</a>;
<a name="l00118"></a>00118       real-&gt;<a class="code" href="structDBusRealString.html#21fb373a65e36646787392a3dfe62443">align_offset</a> = 0;
<a name="l00119"></a>00119     }
<a name="l00120"></a>00120 }
<a name="l00121"></a>00121 
<a name="l00131"></a>00131 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00132"></a><a class="code" href="group__DBusString.html#g569b784beea1b4fa98f05d27e6dd0e72">00132</a> <a class="code" href="group__DBusString.html#g569b784beea1b4fa98f05d27e6dd0e72">_dbus_string_init_preallocated</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00133"></a>00133                                 <span class="keywordtype">int</span>         allocate_size)
<a name="l00134"></a>00134 {
<a name="l00135"></a>00135   <a class="code" href="structDBusRealString.html">DBusRealString</a> *real;
<a name="l00136"></a>00136 
<a name="l00137"></a>00137   _DBUS_STATIC_ASSERT (<span class="keyword">sizeof</span> (<a class="code" href="structDBusString.html">DBusString</a>) == <span class="keyword">sizeof</span> (<a class="code" href="structDBusRealString.html">DBusRealString</a>));
<a name="l00138"></a>00138 
<a name="l00139"></a>00139   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (str != <a class="code" href="group__DBusMacros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00140"></a>00140 
<a name="l00141"></a>00141   real = (DBusRealString*) str;
<a name="l00142"></a>00142 
<a name="l00143"></a>00143   <span class="comment">/* It's very important not to touch anything</span>
<a name="l00144"></a>00144 <span class="comment">   * other than real-&gt;str if we're going to fail,</span>
<a name="l00145"></a>00145 <span class="comment">   * since we also use this function to reset</span>
<a name="l00146"></a>00146 <span class="comment">   * an existing string, e.g. in _dbus_string_steal_data()</span>
<a name="l00147"></a>00147 <span class="comment">   */</span>
<a name="l00148"></a>00148   
<a name="l00149"></a>00149   real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> = <a class="code" href="group__DBusMemory.html#gf6e588659067a854c3cca7ebe8ae5084">dbus_malloc</a> (_DBUS_STRING_ALLOCATION_PADDING + allocate_size);
<a name="l00150"></a>00150   <span class="keywordflow">if</span> (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> == <a class="code" href="group__DBusMacros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00151"></a>00151     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;  
<a name="l00152"></a>00152   
<a name="l00153"></a>00153   real-&gt;<a class="code" href="structDBusRealString.html#e12ec58c271e47f3f89fae1410b7c5e5">allocated</a> = _DBUS_STRING_ALLOCATION_PADDING + allocate_size;
<a name="l00154"></a>00154   real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> = 0;
<a name="l00155"></a>00155   real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>[real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a>] = <span class="charliteral">'\0'</span>;
<a name="l00156"></a>00156   
<a name="l00157"></a>00157   real-&gt;<a class="code" href="structDBusRealString.html#79675cfbe443cc779e3c668fbcb99578">constant</a> = <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00158"></a>00158   real-&gt;<a class="code" href="structDBusRealString.html#865d892d7cacedd598b828c15c5815c5">locked</a> = <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00159"></a>00159   real-&gt;<a class="code" href="structDBusRealString.html#062f6b092cc6c4baf01f2a820e2ba5ad">invalid</a> = <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00160"></a>00160   real-&gt;<a class="code" href="structDBusRealString.html#21fb373a65e36646787392a3dfe62443">align_offset</a> = 0;
<a name="l00161"></a>00161   
<a name="l00162"></a>00162   fixup_alignment (real);
<a name="l00163"></a>00163   
<a name="l00164"></a>00164   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00165"></a>00165 }
<a name="l00166"></a>00166 
<a name="l00174"></a>00174 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00175"></a><a class="code" href="group__DBusString.html#g348252317f7bb8ac43529972945830ae">00175</a> <a class="code" href="group__DBusString.html#g348252317f7bb8ac43529972945830ae">_dbus_string_init</a> (<a class="code" href="structDBusString.html">DBusString</a> *str)
<a name="l00176"></a>00176 {
<a name="l00177"></a>00177   <span class="keywordflow">return</span> <a class="code" href="group__DBusString.html#g569b784beea1b4fa98f05d27e6dd0e72">_dbus_string_init_preallocated</a> (str, 0);
<a name="l00178"></a>00178 }
<a name="l00179"></a>00179 
<a name="l00189"></a>00189 <span class="keywordtype">void</span>
<a name="l00190"></a><a class="code" href="group__DBusString.html#g374640ddfa2f0b27a8356e2379ba8043">00190</a> <a class="code" href="group__DBusString.html#g374640ddfa2f0b27a8356e2379ba8043">_dbus_string_init_const</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00191"></a>00191                          <span class="keyword">const</span> <span class="keywordtype">char</span> *value)
<a name="l00192"></a>00192 {
<a name="l00193"></a>00193   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (value != <a class="code" href="group__DBusMacros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00194"></a>00194   
<a name="l00195"></a>00195   <a class="code" href="group__DBusString.html#g6792a5c1725faa9d635d95f7a3b5bfae">_dbus_string_init_const_len</a> (str, value,
<a name="l00196"></a>00196                                strlen (value));
<a name="l00197"></a>00197 }
<a name="l00198"></a>00198 
<a name="l00209"></a>00209 <span class="keywordtype">void</span>
<a name="l00210"></a><a class="code" href="group__DBusString.html#g6792a5c1725faa9d635d95f7a3b5bfae">00210</a> <a class="code" href="group__DBusString.html#g6792a5c1725faa9d635d95f7a3b5bfae">_dbus_string_init_const_len</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00211"></a>00211                              <span class="keyword">const</span> <span class="keywordtype">char</span> *value,
<a name="l00212"></a>00212                              <span class="keywordtype">int</span>         len)
<a name="l00213"></a>00213 {
<a name="l00214"></a>00214   <a class="code" href="structDBusRealString.html">DBusRealString</a> *real;
<a name="l00215"></a>00215   
<a name="l00216"></a>00216   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (str != <a class="code" href="group__DBusMacros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00217"></a>00217   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len == 0 || value != <a class="code" href="group__DBusMacros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00218"></a>00218   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &lt;= <a class="code" href="group__DBusStringInternals.html#g1e3535c07f25485129d9d17194e303af">_DBUS_STRING_MAX_LENGTH</a>);
<a name="l00219"></a>00219   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &gt;= 0);
<a name="l00220"></a>00220   
<a name="l00221"></a>00221   real = (<a class="code" href="structDBusRealString.html">DBusRealString</a>*) str;
<a name="l00222"></a>00222   
<a name="l00223"></a>00223   real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) value;
<a name="l00224"></a>00224   real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> = len;
<a name="l00225"></a>00225   real-&gt;<a class="code" href="structDBusRealString.html#e12ec58c271e47f3f89fae1410b7c5e5">allocated</a> = real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> + _DBUS_STRING_ALLOCATION_PADDING; <span class="comment">/* a lie, just to avoid special-case assertions... */</span>
<a name="l00226"></a>00226   real-&gt;<a class="code" href="structDBusRealString.html#79675cfbe443cc779e3c668fbcb99578">constant</a> = <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00227"></a>00227   real-&gt;<a class="code" href="structDBusRealString.html#865d892d7cacedd598b828c15c5815c5">locked</a> = <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00228"></a>00228   real-&gt;<a class="code" href="structDBusRealString.html#062f6b092cc6c4baf01f2a820e2ba5ad">invalid</a> = <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00229"></a>00229   real-&gt;<a class="code" href="structDBusRealString.html#21fb373a65e36646787392a3dfe62443">align_offset</a> = 0;
<a name="l00230"></a>00230 
<a name="l00231"></a>00231   <span class="comment">/* We don't require const strings to be 8-byte aligned as the</span>
<a name="l00232"></a>00232 <span class="comment">   * memory is coming from elsewhere.</span>
<a name="l00233"></a>00233 <span class="comment">   */</span>
<a name="l00234"></a>00234 }
<a name="l00235"></a>00235 
<a name="l00244"></a>00244 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00245"></a><a class="code" href="group__DBusString.html#g5c5faea5fac79aad0de9fb1cf6da0393">00245</a> <a class="code" href="group__DBusString.html#g5c5faea5fac79aad0de9fb1cf6da0393">_dbus_string_init_from_string</a>(<a class="code" href="structDBusString.html">DBusString</a>       *str,
<a name="l00246"></a>00246                               <span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *from)
<a name="l00247"></a>00247 {
<a name="l00248"></a>00248  <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#g348252317f7bb8ac43529972945830ae">_dbus_string_init</a> (str))
<a name="l00249"></a>00249      <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00250"></a>00250  <span class="keywordflow">return</span> <a class="code" href="group__DBusString.html#g100c5ce0696822c5a4cfbdfaba674d96">_dbus_string_append</a> (str, _dbus_string_get_const_data (from));
<a name="l00251"></a>00251 }
<a name="l00252"></a>00252 
<a name="l00258"></a>00258 <span class="keywordtype">void</span>
<a name="l00259"></a><a class="code" href="group__DBusString.html#g781ca91acda49a834dce7d0ed0eef212">00259</a> <a class="code" href="group__DBusString.html#g781ca91acda49a834dce7d0ed0eef212">_dbus_string_free</a> (<a class="code" href="structDBusString.html">DBusString</a> *str)
<a name="l00260"></a>00260 {
<a name="l00261"></a>00261   <a class="code" href="structDBusRealString.html">DBusRealString</a> *real = (<a class="code" href="structDBusRealString.html">DBusRealString</a>*) str;
<a name="l00262"></a>00262   <a class="code" href="group__DBusStringInternals.html#g862cb88a139179981e1fcd5643165b56">DBUS_GENERIC_STRING_PREAMBLE</a> (real);
<a name="l00263"></a>00263   
<a name="l00264"></a>00264   <span class="keywordflow">if</span> (real-&gt;constant)
<a name="l00265"></a>00265     <span class="keywordflow">return</span>;
<a name="l00266"></a>00266 
<a name="l00267"></a>00267   <span class="comment">/* so it's safe if @p str returned by a failed</span>
<a name="l00268"></a>00268 <span class="comment">   * _dbus_string_init call</span>
<a name="l00269"></a>00269 <span class="comment">   * Bug: https://bugs.freedesktop.org/show_bug.cgi?id=65959</span>
<a name="l00270"></a>00270 <span class="comment">   */</span>
<a name="l00271"></a>00271   <span class="keywordflow">if</span> (real-&gt;str == <a class="code" href="group__DBusMacros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00272"></a>00272     <span class="keywordflow">return</span>;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274   <a class="code" href="group__DBusMemory.html#g34e666b19b015035a9a31e53da84b39a">dbus_free</a> (real-&gt;str - real-&gt;align_offset);
<a name="l00275"></a>00275 
<a name="l00276"></a>00276   real-&gt;invalid = <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00277"></a>00277 }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 <span class="keyword">static</span> <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00280"></a>00280 compact (<a class="code" href="structDBusRealString.html">DBusRealString</a> *real,
<a name="l00281"></a>00281          <span class="keywordtype">int</span>             max_waste)
<a name="l00282"></a>00282 {
<a name="l00283"></a>00283   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *new_str;
<a name="l00284"></a>00284   <span class="keywordtype">int</span> new_allocated;
<a name="l00285"></a>00285   <span class="keywordtype">int</span> waste;
<a name="l00286"></a>00286 
<a name="l00287"></a>00287   waste = real-&gt;<a class="code" href="structDBusRealString.html#e12ec58c271e47f3f89fae1410b7c5e5">allocated</a> - (real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> + _DBUS_STRING_ALLOCATION_PADDING);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289   <span class="keywordflow">if</span> (waste &lt;= max_waste)
<a name="l00290"></a>00290     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00291"></a>00291 
<a name="l00292"></a>00292   new_allocated = real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> + _DBUS_STRING_ALLOCATION_PADDING;
<a name="l00293"></a>00293 
<a name="l00294"></a>00294   new_str = <a class="code" href="group__DBusMemory.html#g2d505f2960ccf343042d363170b27f9c">dbus_realloc</a> (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> - real-&gt;<a class="code" href="structDBusRealString.html#21fb373a65e36646787392a3dfe62443">align_offset</a>, new_allocated);
<a name="l00295"></a>00295   <span class="keywordflow">if</span> (_DBUS_UNLIKELY (new_str == <a class="code" href="group__DBusMacros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
<a name="l00296"></a>00296     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00297"></a>00297 
<a name="l00298"></a>00298   real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> = new_str + real-&gt;<a class="code" href="structDBusRealString.html#21fb373a65e36646787392a3dfe62443">align_offset</a>;
<a name="l00299"></a>00299   real-&gt;<a class="code" href="structDBusRealString.html#e12ec58c271e47f3f89fae1410b7c5e5">allocated</a> = new_allocated;
<a name="l00300"></a>00300   fixup_alignment (real);
<a name="l00301"></a>00301 
<a name="l00302"></a>00302   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00303"></a>00303 }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305 <span class="preprocessor">#ifdef DBUS_ENABLE_EMBEDDED_TESTS</span>
<a name="l00306"></a>00306 <span class="preprocessor"></span><span class="comment">/* Not using this feature at the moment,</span>
<a name="l00307"></a>00307 <span class="comment"> * so marked DBUS_ENABLE_EMBEDDED_TESTS-only</span>
<a name="l00308"></a>00308 <span class="comment"> */</span>
<a name="l00318"></a>00318 <span class="keywordtype">void</span>
<a name="l00319"></a>00319 _dbus_string_lock (<a class="code" href="structDBusString.html">DBusString</a> *str)
<a name="l00320"></a>00320 {  
<a name="l00321"></a>00321   <a class="code" href="group__DBusStringInternals.html#gd9f957c4027c34a5c330822aa98b9307">DBUS_LOCKED_STRING_PREAMBLE</a> (str); <span class="comment">/* can lock multiple times */</span>
<a name="l00322"></a>00322 
<a name="l00323"></a>00323   real-&gt;<a class="code" href="structDBusRealString.html#865d892d7cacedd598b828c15c5815c5">locked</a> = <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00324"></a>00324 
<a name="l00325"></a>00325   <span class="comment">/* Try to realloc to avoid excess memory usage, since</span>
<a name="l00326"></a>00326 <span class="comment">   * we know we won't change the string further</span>
<a name="l00327"></a>00327 <span class="comment">   */</span>
<a name="l00328"></a>00328 <span class="preprocessor">#define MAX_WASTE 48</span>
<a name="l00329"></a>00329 <span class="preprocessor"></span>  compact (real, MAX_WASTE);
<a name="l00330"></a>00330 }
<a name="l00331"></a>00331 <span class="preprocessor">#endif </span><span class="comment">/* DBUS_ENABLE_EMBEDDED_TESTS */</span>
<a name="l00332"></a>00332 
<a name="l00333"></a>00333 <span class="keyword">static</span> <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00334"></a>00334 reallocate_for_length (<a class="code" href="structDBusRealString.html">DBusRealString</a> *real,
<a name="l00335"></a>00335                        <span class="keywordtype">int</span>             new_length)
<a name="l00336"></a>00336 {
<a name="l00337"></a>00337   <span class="keywordtype">int</span> new_allocated;
<a name="l00338"></a>00338   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *new_str;
<a name="l00339"></a>00339 
<a name="l00340"></a>00340   <span class="comment">/* at least double our old allocation to avoid O(n), avoiding</span>
<a name="l00341"></a>00341 <span class="comment">   * overflow</span>
<a name="l00342"></a>00342 <span class="comment">   */</span>
<a name="l00343"></a>00343   <span class="keywordflow">if</span> (real-&gt;<a class="code" href="structDBusRealString.html#e12ec58c271e47f3f89fae1410b7c5e5">allocated</a> &gt; (<a class="code" href="group__DBusStringInternals.html#g1e3535c07f25485129d9d17194e303af">_DBUS_STRING_MAX_LENGTH</a> + _DBUS_STRING_ALLOCATION_PADDING) / 2)
<a name="l00344"></a>00344     new_allocated = <a class="code" href="group__DBusStringInternals.html#g1e3535c07f25485129d9d17194e303af">_DBUS_STRING_MAX_LENGTH</a> + _DBUS_STRING_ALLOCATION_PADDING;
<a name="l00345"></a>00345   <span class="keywordflow">else</span>
<a name="l00346"></a>00346     new_allocated = real-&gt;<a class="code" href="structDBusRealString.html#e12ec58c271e47f3f89fae1410b7c5e5">allocated</a> * 2;
<a name="l00347"></a>00347 
<a name="l00348"></a>00348   <span class="comment">/* if you change the code just above here, run the tests without</span>
<a name="l00349"></a>00349 <span class="comment">   * the following assert-only hack before you commit</span>
<a name="l00350"></a>00350 <span class="comment">   */</span>
<a name="l00351"></a>00351   <span class="comment">/* This is keyed off asserts in addition to tests so when you</span>
<a name="l00352"></a>00352 <span class="comment">   * disable asserts to profile, you don't get this destroyer</span>
<a name="l00353"></a>00353 <span class="comment">   * of profiles.</span>
<a name="l00354"></a>00354 <span class="comment">   */</span>
<a name="l00355"></a>00355 <span class="preprocessor">#if defined (DBUS_ENABLE_EMBEDDED_TESTS) &amp;&amp; !defined (DBUS_DISABLE_ASSERT)</span>
<a name="l00356"></a>00356 <span class="preprocessor"></span>  new_allocated = 0; <span class="comment">/* ensure a realloc every time so that we go</span>
<a name="l00357"></a>00357 <span class="comment">                      * through all malloc failure codepaths</span>
<a name="l00358"></a>00358 <span class="comment">                      */</span>
<a name="l00359"></a>00359 <span class="preprocessor">#endif</span>
<a name="l00360"></a>00360 <span class="preprocessor"></span>
<a name="l00361"></a>00361   <span class="comment">/* But be sure we always alloc at least space for the new length */</span>
<a name="l00362"></a>00362   new_allocated = MAX (new_allocated,
<a name="l00363"></a>00363                        new_length + _DBUS_STRING_ALLOCATION_PADDING);
<a name="l00364"></a>00364 
<a name="l00365"></a>00365   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (new_allocated &gt;= real-&gt;<a class="code" href="structDBusRealString.html#e12ec58c271e47f3f89fae1410b7c5e5">allocated</a>); <span class="comment">/* code relies on this */</span>
<a name="l00366"></a>00366   new_str = <a class="code" href="group__DBusMemory.html#g2d505f2960ccf343042d363170b27f9c">dbus_realloc</a> (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> - real-&gt;<a class="code" href="structDBusRealString.html#21fb373a65e36646787392a3dfe62443">align_offset</a>, new_allocated);
<a name="l00367"></a>00367   <span class="keywordflow">if</span> (_DBUS_UNLIKELY (new_str == <a class="code" href="group__DBusMacros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
<a name="l00368"></a>00368     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00369"></a>00369 
<a name="l00370"></a>00370   real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> = new_str + real-&gt;<a class="code" href="structDBusRealString.html#21fb373a65e36646787392a3dfe62443">align_offset</a>;
<a name="l00371"></a>00371   real-&gt;<a class="code" href="structDBusRealString.html#e12ec58c271e47f3f89fae1410b7c5e5">allocated</a> = new_allocated;
<a name="l00372"></a>00372   fixup_alignment (real);
<a name="l00373"></a>00373 
<a name="l00374"></a>00374   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00375"></a>00375 }
<a name="l00376"></a>00376 
<a name="l00388"></a>00388 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00389"></a><a class="code" href="group__DBusString.html#gc49ec5782ca606029c096124b5e43ffc">00389</a> <a class="code" href="group__DBusString.html#gc49ec5782ca606029c096124b5e43ffc">_dbus_string_compact</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00390"></a>00390                       <span class="keywordtype">int</span>         max_waste)
<a name="l00391"></a>00391 {
<a name="l00392"></a>00392   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00393"></a>00393 
<a name="l00394"></a>00394   <span class="keywordflow">return</span> compact (real, max_waste);
<a name="l00395"></a>00395 }
<a name="l00396"></a>00396 
<a name="l00397"></a>00397 <span class="keyword">static</span> <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00398"></a>00398 set_length (<a class="code" href="structDBusRealString.html">DBusRealString</a> *real,
<a name="l00399"></a>00399             <span class="keywordtype">int</span>             new_length)
<a name="l00400"></a>00400 {
<a name="l00401"></a>00401   <span class="comment">/* Note, we are setting the length not including nul termination */</span>
<a name="l00402"></a>00402 
<a name="l00403"></a>00403   <span class="comment">/* exceeding max length is the same as failure to allocate memory */</span>
<a name="l00404"></a>00404   <span class="keywordflow">if</span> (_DBUS_UNLIKELY (new_length &gt; <a class="code" href="group__DBusStringInternals.html#g1e3535c07f25485129d9d17194e303af">_DBUS_STRING_MAX_LENGTH</a>))
<a name="l00405"></a>00405     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00406"></a>00406   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (new_length &gt; (real-&gt;<a class="code" href="structDBusRealString.html#e12ec58c271e47f3f89fae1410b7c5e5">allocated</a> - _DBUS_STRING_ALLOCATION_PADDING) &amp;&amp;
<a name="l00407"></a>00407            _DBUS_UNLIKELY (!reallocate_for_length (real, new_length)))
<a name="l00408"></a>00408     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00409"></a>00409   <span class="keywordflow">else</span>
<a name="l00410"></a>00410     {
<a name="l00411"></a>00411       real-&gt;len = new_length;
<a name="l00412"></a>00412       real-&gt;str[new_length] = <span class="charliteral">'\0'</span>;
<a name="l00413"></a>00413       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00414"></a>00414     }
<a name="l00415"></a>00415 }
<a name="l00416"></a>00416 
<a name="l00417"></a>00417 <span class="keyword">static</span> <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00418"></a>00418 open_gap (<span class="keywordtype">int</span>             len,
<a name="l00419"></a>00419           <a class="code" href="structDBusRealString.html">DBusRealString</a> *dest,
<a name="l00420"></a>00420           <span class="keywordtype">int</span>             insert_at)
<a name="l00421"></a>00421 {
<a name="l00422"></a>00422   <span class="keywordflow">if</span> (len == 0)
<a name="l00423"></a>00423     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00424"></a>00424 
<a name="l00425"></a>00425   <span class="keywordflow">if</span> (len &gt; <a class="code" href="group__DBusStringInternals.html#g1e3535c07f25485129d9d17194e303af">_DBUS_STRING_MAX_LENGTH</a> - dest-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a>)
<a name="l00426"></a>00426     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* detected overflow of dest-&gt;len + len below */</span>
<a name="l00427"></a>00427   
<a name="l00428"></a>00428   <span class="keywordflow">if</span> (!set_length (dest, dest-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> + len))
<a name="l00429"></a>00429     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00430"></a>00430 
<a name="l00431"></a>00431   memmove (dest-&gt;str + insert_at + len, 
<a name="l00432"></a>00432            dest-&gt;str + insert_at,
<a name="l00433"></a>00433            dest-&gt;len - len - insert_at);
<a name="l00434"></a>00434 
<a name="l00435"></a>00435   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00436"></a>00436 }
<a name="l00437"></a>00437 
<a name="l00438"></a>00438 <span class="preprocessor">#ifndef _dbus_string_get_data</span>
<a name="l00439"></a>00439 <span class="preprocessor"></span>
<a name="l00450"></a>00450 <span class="keywordtype">char</span>*
<a name="l00451"></a>00451 _dbus_string_get_data (<a class="code" href="structDBusString.html">DBusString</a> *str)
<a name="l00452"></a>00452 {
<a name="l00453"></a>00453   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00454"></a>00454   
<a name="l00455"></a>00455   <span class="keywordflow">return</span> (<span class="keywordtype">char</span>*) real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>;
<a name="l00456"></a>00456 }
<a name="l00457"></a>00457 <span class="preprocessor">#endif </span><span class="comment">/* _dbus_string_get_data */</span>
<a name="l00458"></a>00458 
<a name="l00459"></a>00459 <span class="comment">/* only do the function if we don't have the macro */</span>
<a name="l00460"></a>00460 <span class="preprocessor">#ifndef _dbus_string_get_const_data</span>
<a name="l00461"></a>00461 <span class="preprocessor"></span>
<a name="l00467"></a>00467 <span class="keyword">const</span> <span class="keywordtype">char</span>*
<a name="l00468"></a>00468 _dbus_string_get_const_data (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a>  *str)
<a name="l00469"></a>00469 {
<a name="l00470"></a>00470   <a class="code" href="group__DBusStringInternals.html#g5cf5f12f6d8f839e9a7c3ad790a83316">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l00471"></a>00471   
<a name="l00472"></a>00472   <span class="keywordflow">return</span> (<span class="keyword">const</span> <span class="keywordtype">char</span>*) real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>;
<a name="l00473"></a>00473 }
<a name="l00474"></a>00474 <span class="preprocessor">#endif </span><span class="comment">/* _dbus_string_get_const_data */</span>
<a name="l00475"></a>00475 
<a name="l00489"></a>00489 <span class="keywordtype">char</span>*
<a name="l00490"></a><a class="code" href="group__DBusString.html#g7a73fb373398606e6e1d0a86c4587a3c">00490</a> <a class="code" href="group__DBusString.html#g7a73fb373398606e6e1d0a86c4587a3c">_dbus_string_get_data_len</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00491"></a>00491                            <span class="keywordtype">int</span>         start,
<a name="l00492"></a>00492                            <span class="keywordtype">int</span>         len)
<a name="l00493"></a>00493 {
<a name="l00494"></a>00494   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00495"></a>00495   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &gt;= 0);
<a name="l00496"></a>00496   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &gt;= 0);
<a name="l00497"></a>00497   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &lt;= real-&gt;len);
<a name="l00498"></a>00498   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &lt;= real-&gt;len - start);
<a name="l00499"></a>00499   
<a name="l00500"></a>00500   <span class="keywordflow">return</span> (<span class="keywordtype">char</span>*) real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> + start;
<a name="l00501"></a>00501 }
<a name="l00502"></a>00502 
<a name="l00503"></a>00503 <span class="comment">/* only do the function if we don't have the macro */</span>
<a name="l00504"></a>00504 <span class="preprocessor">#ifndef _dbus_string_get_const_data_len</span>
<a name="l00505"></a>00505 <span class="preprocessor"></span>
<a name="l00513"></a>00513 <span class="keyword">const</span> <span class="keywordtype">char</span>*
<a name="l00514"></a>00514 _dbus_string_get_const_data_len (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a>  *str,
<a name="l00515"></a>00515                                  <span class="keywordtype">int</span>                start,
<a name="l00516"></a>00516                                  <span class="keywordtype">int</span>                len)
<a name="l00517"></a>00517 {
<a name="l00518"></a>00518   <a class="code" href="group__DBusStringInternals.html#g5cf5f12f6d8f839e9a7c3ad790a83316">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l00519"></a>00519   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &gt;= 0);
<a name="l00520"></a>00520   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &gt;= 0);
<a name="l00521"></a>00521   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &lt;= real-&gt;len);
<a name="l00522"></a>00522   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &lt;= real-&gt;len - start);
<a name="l00523"></a>00523   
<a name="l00524"></a>00524   <span class="keywordflow">return</span> (<span class="keyword">const</span> <span class="keywordtype">char</span>*) real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> + start;
<a name="l00525"></a>00525 }
<a name="l00526"></a>00526 <span class="preprocessor">#endif </span><span class="comment">/* _dbus_string_get_const_data_len */</span>
<a name="l00527"></a>00527 
<a name="l00528"></a>00528 <span class="comment">/* only do the function if we don't have the macro */</span>
<a name="l00529"></a>00529 <span class="preprocessor">#ifndef _dbus_string_set_byte</span>
<a name="l00530"></a>00530 <span class="preprocessor"></span>
<a name="l00537"></a>00537 <span class="keywordtype">void</span>
<a name="l00538"></a>00538 _dbus_string_set_byte (<a class="code" href="structDBusString.html">DBusString</a>    *str,
<a name="l00539"></a>00539                        <span class="keywordtype">int</span>            i,
<a name="l00540"></a>00540                        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>  byte)
<a name="l00541"></a>00541 {
<a name="l00542"></a>00542   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00543"></a>00543   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (i &lt; real-&gt;len);
<a name="l00544"></a>00544   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (i &gt;= 0);
<a name="l00545"></a>00545   
<a name="l00546"></a>00546   real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>[i] = byte;
<a name="l00547"></a>00547 }
<a name="l00548"></a>00548 <span class="preprocessor">#endif </span><span class="comment">/* _dbus_string_set_byte */</span>
<a name="l00549"></a>00549 
<a name="l00550"></a>00550 <span class="comment">/* only have the function if we didn't create a macro */</span>
<a name="l00551"></a>00551 <span class="preprocessor">#ifndef _dbus_string_get_byte</span>
<a name="l00552"></a>00552 <span class="preprocessor"></span>
<a name="l00561"></a>00561 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>
<a name="l00562"></a>00562 _dbus_string_get_byte (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a>  *str,
<a name="l00563"></a>00563                        <span class="keywordtype">int</span>                start)
<a name="l00564"></a>00564 {
<a name="l00565"></a>00565   <a class="code" href="group__DBusStringInternals.html#g5cf5f12f6d8f839e9a7c3ad790a83316">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l00566"></a>00566   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &lt;= real-&gt;len);
<a name="l00567"></a>00567   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &gt;= 0);
<a name="l00568"></a>00568   
<a name="l00569"></a>00569   <span class="keywordflow">return</span> real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>[start];
<a name="l00570"></a>00570 }
<a name="l00571"></a>00571 <span class="preprocessor">#endif </span><span class="comment">/* _dbus_string_get_byte */</span>
<a name="l00572"></a>00572 
<a name="l00583"></a>00583 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00584"></a><a class="code" href="group__DBusString.html#ga0964d662ad17c58eb044c1b153017a6">00584</a> <a class="code" href="group__DBusString.html#ga0964d662ad17c58eb044c1b153017a6">_dbus_string_insert_bytes</a> (<a class="code" href="structDBusString.html">DBusString</a>   *str,
<a name="l00585"></a>00585                            <span class="keywordtype">int</span>           i,
<a name="l00586"></a>00586                            <span class="keywordtype">int</span>           n_bytes,
<a name="l00587"></a>00587                            <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> byte)
<a name="l00588"></a>00588 {
<a name="l00589"></a>00589   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00590"></a>00590   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (i &lt;= real-&gt;len);
<a name="l00591"></a>00591   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (i &gt;= 0);
<a name="l00592"></a>00592   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (n_bytes &gt;= 0);
<a name="l00593"></a>00593 
<a name="l00594"></a>00594   <span class="keywordflow">if</span> (n_bytes == 0)
<a name="l00595"></a>00595     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00596"></a>00596   
<a name="l00597"></a>00597   <span class="keywordflow">if</span> (!open_gap (n_bytes, real, i))
<a name="l00598"></a>00598     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00599"></a>00599   
<a name="l00600"></a>00600   memset (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> + i, byte, n_bytes);
<a name="l00601"></a>00601 
<a name="l00602"></a>00602   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00603"></a>00603 }
<a name="l00604"></a>00604 
<a name="l00613"></a>00613 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00614"></a><a class="code" href="group__DBusString.html#gb0770800dce6df97e5d246105a44e7b4">00614</a> <a class="code" href="group__DBusString.html#gb0770800dce6df97e5d246105a44e7b4">_dbus_string_insert_byte</a> (<a class="code" href="structDBusString.html">DBusString</a>   *str,
<a name="l00615"></a>00615                            <span class="keywordtype">int</span>           i,
<a name="l00616"></a>00616                            <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> byte)
<a name="l00617"></a>00617 {
<a name="l00618"></a>00618   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00619"></a>00619   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (i &lt;= real-&gt;len);
<a name="l00620"></a>00620   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (i &gt;= 0);
<a name="l00621"></a>00621   
<a name="l00622"></a>00622   <span class="keywordflow">if</span> (!open_gap (1, real, i))
<a name="l00623"></a>00623     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00624"></a>00624 
<a name="l00625"></a>00625   real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>[i] = byte;
<a name="l00626"></a>00626 
<a name="l00627"></a>00627   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00628"></a>00628 }
<a name="l00629"></a>00629 
<a name="l00640"></a>00640 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00641"></a><a class="code" href="group__DBusString.html#g556cc30c3ab032dbc63e217119f0d1f5">00641</a> <a class="code" href="group__DBusString.html#g556cc30c3ab032dbc63e217119f0d1f5">_dbus_string_steal_data</a> (<a class="code" href="structDBusString.html">DBusString</a>        *str,
<a name="l00642"></a>00642                          <span class="keywordtype">char</span>             **data_return)
<a name="l00643"></a>00643 {
<a name="l00644"></a>00644   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00645"></a>00645   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (data_return != <a class="code" href="group__DBusMacros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00646"></a>00646 
<a name="l00647"></a>00647   undo_alignment (real);
<a name="l00648"></a>00648   
<a name="l00649"></a>00649   *data_return = (<span class="keywordtype">char</span>*) real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>;
<a name="l00650"></a>00650 
<a name="l00651"></a>00651   <span class="comment">/* reset the string */</span>
<a name="l00652"></a>00652   if (!<a class="code" href="group__DBusString.html#g348252317f7bb8ac43529972945830ae">_dbus_string_init</a> (str))
<a name="l00653"></a>00653     {
<a name="l00654"></a>00654       <span class="comment">/* hrm, put it back then */</span>
<a name="l00655"></a>00655       real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) *data_return;
<a name="l00656"></a>00656       *data_return = <a class="code" href="group__DBusMacros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00657"></a>00657       fixup_alignment (real);
<a name="l00658"></a>00658       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00659"></a>00659     }
<a name="l00660"></a>00660 
<a name="l00661"></a>00661   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00662"></a>00662 }
<a name="l00663"></a>00663 
<a name="l00671"></a>00671 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00672"></a><a class="code" href="group__DBusString.html#g7e509d4f959d19d96f83250e62287b06">00672</a> <a class="code" href="group__DBusString.html#g7e509d4f959d19d96f83250e62287b06">_dbus_string_copy_data</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a>  *str,
<a name="l00673"></a>00673                         <span class="keywordtype">char</span>             **data_return)
<a name="l00674"></a>00674 {
<a name="l00675"></a>00675   <a class="code" href="group__DBusStringInternals.html#g5cf5f12f6d8f839e9a7c3ad790a83316">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l00676"></a>00676   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (data_return != <a class="code" href="group__DBusMacros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00677"></a>00677   
<a name="l00678"></a>00678   *data_return = <a class="code" href="group__DBusMemory.html#gf6e588659067a854c3cca7ebe8ae5084">dbus_malloc</a> (real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> + 1);
<a name="l00679"></a>00679   <span class="keywordflow">if</span> (*data_return == <a class="code" href="group__DBusMacros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00680"></a>00680     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00681"></a>00681 
<a name="l00682"></a>00682   memcpy (*data_return, real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>, real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> + 1);
<a name="l00683"></a>00683 
<a name="l00684"></a>00684   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00685"></a>00685 }
<a name="l00686"></a>00686 
<a name="l00696"></a>00696 <span class="keywordtype">void</span>
<a name="l00697"></a><a class="code" href="group__DBusString.html#gf97b18e419678dbf967d9b9ad1112ca6">00697</a> <a class="code" href="group__DBusString.html#gf97b18e419678dbf967d9b9ad1112ca6">_dbus_string_copy_to_buffer</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a>  *str,
<a name="l00698"></a>00698                              <span class="keywordtype">char</span>              *buffer,
<a name="l00699"></a>00699                              <span class="keywordtype">int</span>                avail_len)
<a name="l00700"></a>00700 {
<a name="l00701"></a>00701   <a class="code" href="group__DBusStringInternals.html#g5cf5f12f6d8f839e9a7c3ad790a83316">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l00702"></a>00702 
<a name="l00703"></a>00703   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (avail_len &gt;= 0);
<a name="l00704"></a>00704   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (avail_len &gt;= real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a>);
<a name="l00705"></a>00705   
<a name="l00706"></a>00706   memcpy (buffer, real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>, real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a>);
<a name="l00707"></a>00707 }
<a name="l00708"></a>00708 
<a name="l00718"></a>00718 <span class="keywordtype">void</span>
<a name="l00719"></a><a class="code" href="group__DBusString.html#gc42891d26084a4da0f63038d93b63828">00719</a> <a class="code" href="group__DBusString.html#gc42891d26084a4da0f63038d93b63828">_dbus_string_copy_to_buffer_with_nul</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a>  *str,
<a name="l00720"></a>00720                                       <span class="keywordtype">char</span>              *buffer,
<a name="l00721"></a>00721                                       <span class="keywordtype">int</span>                avail_len)
<a name="l00722"></a>00722 {
<a name="l00723"></a>00723   <a class="code" href="group__DBusStringInternals.html#g5cf5f12f6d8f839e9a7c3ad790a83316">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l00724"></a>00724 
<a name="l00725"></a>00725   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (avail_len &gt;= 0);
<a name="l00726"></a>00726   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (avail_len &gt; real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a>);
<a name="l00727"></a>00727   
<a name="l00728"></a>00728   memcpy (buffer, real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>, real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a>+1);
<a name="l00729"></a>00729 }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731 <span class="comment">/* Only have the function if we don't have the macro */</span>
<a name="l00732"></a>00732 <span class="preprocessor">#ifndef _dbus_string_get_length</span>
<a name="l00733"></a>00733 <span class="preprocessor"></span>
<a name="l00738"></a>00738 <span class="keywordtype">int</span>
<a name="l00739"></a>00739 _dbus_string_get_length (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a>  *str)
<a name="l00740"></a>00740 {
<a name="l00741"></a>00741   <a class="code" href="group__DBusStringInternals.html#g5cf5f12f6d8f839e9a7c3ad790a83316">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l00742"></a>00742   
<a name="l00743"></a>00743   <span class="keywordflow">return</span> real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a>;
<a name="l00744"></a>00744 }
<a name="l00745"></a>00745 <span class="preprocessor">#endif </span><span class="comment">/* !_dbus_string_get_length */</span>
<a name="l00746"></a>00746 
<a name="l00759"></a>00759 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00760"></a><a class="code" href="group__DBusString.html#g8f13997d90ceed2f437706e6b7804d9b">00760</a> <a class="code" href="group__DBusString.html#g8f13997d90ceed2f437706e6b7804d9b">_dbus_string_lengthen</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00761"></a>00761                        <span class="keywordtype">int</span>         additional_length)
<a name="l00762"></a>00762 {
<a name="l00763"></a>00763   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);  
<a name="l00764"></a>00764   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (additional_length &gt;= 0);
<a name="l00765"></a>00765 
<a name="l00766"></a>00766   <span class="keywordflow">if</span> (_DBUS_UNLIKELY (additional_length &gt; <a class="code" href="group__DBusStringInternals.html#g1e3535c07f25485129d9d17194e303af">_DBUS_STRING_MAX_LENGTH</a> - real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a>))
<a name="l00767"></a>00767     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* would overflow */</span>
<a name="l00768"></a>00768   
<a name="l00769"></a>00769   <span class="keywordflow">return</span> set_length (real,
<a name="l00770"></a>00770                      real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> + additional_length);
<a name="l00771"></a>00771 }
<a name="l00772"></a>00772 
<a name="l00779"></a>00779 <span class="keywordtype">void</span>
<a name="l00780"></a><a class="code" href="group__DBusString.html#g7af1cbfa905f26d972ab644d890548b8">00780</a> <a class="code" href="group__DBusString.html#g7af1cbfa905f26d972ab644d890548b8">_dbus_string_shorten</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00781"></a>00781                       <span class="keywordtype">int</span>         length_to_remove)
<a name="l00782"></a>00782 {
<a name="l00783"></a>00783   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00784"></a>00784   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (length_to_remove &gt;= 0);
<a name="l00785"></a>00785   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (length_to_remove &lt;= real-&gt;len);
<a name="l00786"></a>00786 
<a name="l00787"></a>00787   set_length (real,
<a name="l00788"></a>00788               real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> - length_to_remove);
<a name="l00789"></a>00789 }
<a name="l00790"></a>00790 
<a name="l00801"></a>00801 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00802"></a><a class="code" href="group__DBusString.html#g08c423b93c28dd746dcb93e0461ab95c">00802</a> <a class="code" href="group__DBusString.html#g08c423b93c28dd746dcb93e0461ab95c">_dbus_string_set_length</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00803"></a>00803                          <span class="keywordtype">int</span>         length)
<a name="l00804"></a>00804 {
<a name="l00805"></a>00805   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00806"></a>00806   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (length &gt;= 0);
<a name="l00807"></a>00807 
<a name="l00808"></a>00808   <span class="keywordflow">return</span> set_length (real, length);
<a name="l00809"></a>00809 }
<a name="l00810"></a>00810 
<a name="l00811"></a>00811 <span class="keyword">static</span> <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00812"></a>00812 align_insert_point_then_open_gap (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00813"></a>00813                                   <span class="keywordtype">int</span>        *insert_at_p,
<a name="l00814"></a>00814                                   <span class="keywordtype">int</span>         alignment,
<a name="l00815"></a>00815                                   <span class="keywordtype">int</span>         gap_size)
<a name="l00816"></a>00816 {
<a name="l00817"></a>00817   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> new_len; <span class="comment">/* ulong to avoid _DBUS_ALIGN_VALUE overflow */</span>
<a name="l00818"></a>00818   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> gap_pos;
<a name="l00819"></a>00819   <span class="keywordtype">int</span> insert_at;
<a name="l00820"></a>00820   <span class="keywordtype">int</span> delta;
<a name="l00821"></a>00821   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00822"></a>00822   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (alignment &gt;= 1);
<a name="l00823"></a>00823   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (alignment &lt;= 8); <span class="comment">/* it has to be a bug if &gt; 8 */</span>
<a name="l00824"></a>00824 
<a name="l00825"></a>00825   insert_at = *insert_at_p;
<a name="l00826"></a>00826 
<a name="l00827"></a>00827   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (insert_at &lt;= real-&gt;len);
<a name="l00828"></a>00828   
<a name="l00829"></a>00829   gap_pos = _DBUS_ALIGN_VALUE (insert_at, alignment);
<a name="l00830"></a>00830   new_len = real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> + (gap_pos - insert_at) + gap_size;
<a name="l00831"></a>00831   
<a name="l00832"></a>00832   <span class="keywordflow">if</span> (_DBUS_UNLIKELY (new_len &gt; (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) <a class="code" href="group__DBusStringInternals.html#g1e3535c07f25485129d9d17194e303af">_DBUS_STRING_MAX_LENGTH</a>))
<a name="l00833"></a>00833     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00834"></a>00834   
<a name="l00835"></a>00835   delta = new_len - real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a>;
<a name="l00836"></a>00836   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (delta &gt;= 0);
<a name="l00837"></a>00837 
<a name="l00838"></a>00838   <span class="keywordflow">if</span> (delta == 0) <span class="comment">/* only happens if gap_size == 0 and insert_at is aligned already */</span>
<a name="l00839"></a>00839     {
<a name="l00840"></a>00840       <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) *insert_at_p) == gap_pos);
<a name="l00841"></a>00841       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00842"></a>00842     }
<a name="l00843"></a>00843 
<a name="l00844"></a>00844   <span class="keywordflow">if</span> (_DBUS_UNLIKELY (!open_gap (new_len - real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a>,
<a name="l00845"></a>00845                                  real, insert_at)))
<a name="l00846"></a>00846     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00847"></a>00847 
<a name="l00848"></a>00848   <span class="comment">/* nul the padding if we had to add any padding */</span>
<a name="l00849"></a>00849   <span class="keywordflow">if</span> (gap_size &lt; delta)
<a name="l00850"></a>00850     {
<a name="l00851"></a>00851       memset (&amp;real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>[insert_at], <span class="charliteral">'\0'</span>,
<a name="l00852"></a>00852               gap_pos - insert_at);
<a name="l00853"></a>00853     }
<a name="l00854"></a>00854 
<a name="l00855"></a>00855   *insert_at_p = gap_pos;
<a name="l00856"></a>00856   
<a name="l00857"></a>00857   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00858"></a>00858 }
<a name="l00859"></a>00859 
<a name="l00860"></a>00860 <span class="keyword">static</span> <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00861"></a>00861 align_length_then_lengthen (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00862"></a>00862                             <span class="keywordtype">int</span>         alignment,
<a name="l00863"></a>00863                             <span class="keywordtype">int</span>         then_lengthen_by)
<a name="l00864"></a>00864 {
<a name="l00865"></a>00865   <span class="keywordtype">int</span> insert_at;
<a name="l00866"></a>00866 
<a name="l00867"></a>00867   insert_at = _dbus_string_get_length (str);
<a name="l00868"></a>00868   
<a name="l00869"></a>00869   <span class="keywordflow">return</span> align_insert_point_then_open_gap (str,
<a name="l00870"></a>00870                                            &amp;insert_at,
<a name="l00871"></a>00871                                            alignment, then_lengthen_by);
<a name="l00872"></a>00872 }
<a name="l00873"></a>00873 
<a name="l00882"></a>00882 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00883"></a><a class="code" href="group__DBusString.html#geadfb67c4e796131610499c91d0d7813">00883</a> <a class="code" href="group__DBusString.html#geadfb67c4e796131610499c91d0d7813">_dbus_string_align_length</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00884"></a>00884                            <span class="keywordtype">int</span>         alignment)
<a name="l00885"></a>00885 {
<a name="l00886"></a>00886   <span class="keywordflow">return</span> align_length_then_lengthen (str, alignment, 0);
<a name="l00887"></a>00887 }
<a name="l00888"></a>00888 
<a name="l00898"></a>00898 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00899"></a><a class="code" href="group__DBusString.html#g4764e75c464356408fc1a12df93177c1">00899</a> <a class="code" href="group__DBusString.html#g4764e75c464356408fc1a12df93177c1">_dbus_string_alloc_space</a> (<a class="code" href="structDBusString.html">DBusString</a>        *str,
<a name="l00900"></a>00900                           <span class="keywordtype">int</span>                extra_bytes)
<a name="l00901"></a>00901 {
<a name="l00902"></a>00902   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#g8f13997d90ceed2f437706e6b7804d9b">_dbus_string_lengthen</a> (str, extra_bytes))
<a name="l00903"></a>00903     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00904"></a>00904   <a class="code" href="group__DBusString.html#g7af1cbfa905f26d972ab644d890548b8">_dbus_string_shorten</a> (str, extra_bytes);
<a name="l00905"></a>00905 
<a name="l00906"></a>00906   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00907"></a>00907 }
<a name="l00908"></a>00908 
<a name="l00909"></a>00909 <span class="keyword">static</span> <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00910"></a>00910 append (<a class="code" href="structDBusRealString.html">DBusRealString</a> *real,
<a name="l00911"></a>00911         <span class="keyword">const</span> <span class="keywordtype">char</span>     *buffer,
<a name="l00912"></a>00912         <span class="keywordtype">int</span>             buffer_len)
<a name="l00913"></a>00913 {
<a name="l00914"></a>00914   <span class="keywordflow">if</span> (buffer_len == 0)
<a name="l00915"></a>00915     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00916"></a>00916 
<a name="l00917"></a>00917   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#g8f13997d90ceed2f437706e6b7804d9b">_dbus_string_lengthen</a> ((<a class="code" href="structDBusString.html">DBusString</a>*)real, buffer_len))
<a name="l00918"></a>00918     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00919"></a>00919 
<a name="l00920"></a>00920   memcpy (real-&gt;str + (real-&gt;len - buffer_len),
<a name="l00921"></a>00921           buffer,
<a name="l00922"></a>00922           buffer_len);
<a name="l00923"></a>00923 
<a name="l00924"></a>00924   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00925"></a>00925 }
<a name="l00926"></a>00926 
<a name="l00934"></a>00934 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00935"></a><a class="code" href="group__DBusString.html#g100c5ce0696822c5a4cfbdfaba674d96">00935</a> <a class="code" href="group__DBusString.html#g100c5ce0696822c5a4cfbdfaba674d96">_dbus_string_append</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l00936"></a>00936                      <span class="keyword">const</span> <span class="keywordtype">char</span> *buffer)
<a name="l00937"></a>00937 {
<a name="l00938"></a>00938   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> buffer_len;
<a name="l00939"></a>00939   
<a name="l00940"></a>00940   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00941"></a>00941   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (buffer != <a class="code" href="group__DBusMacros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00942"></a>00942   
<a name="l00943"></a>00943   buffer_len = strlen (buffer);
<a name="l00944"></a>00944   <span class="keywordflow">if</span> (buffer_len &gt; (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) _DBUS_STRING_MAX_LENGTH)
<a name="l00945"></a>00945     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00946"></a>00946   
<a name="l00947"></a>00947   <span class="keywordflow">return</span> append (real, buffer, buffer_len);
<a name="l00948"></a>00948 }
<a name="l00949"></a>00949 
<a name="l00951"></a><a class="code" href="group__DBusString.html#g4661e2b10dd3da080564b1191acb7619">00951</a> <span class="preprocessor">#define ASSIGN_2_OCTETS(p, octets) \</span>
<a name="l00952"></a>00952 <span class="preprocessor">  *((dbus_uint16_t*)(p)) = *((dbus_uint16_t*)(octets));</span>
<a name="l00953"></a>00953 <span class="preprocessor"></span>
<a name="l00955"></a><a class="code" href="group__DBusString.html#ge777c8fb39aef558604506d645af6420">00955</a> <span class="preprocessor">#define ASSIGN_4_OCTETS(p, octets) \</span>
<a name="l00956"></a>00956 <span class="preprocessor">  *((dbus_uint32_t*)(p)) = *((dbus_uint32_t*)(octets));</span>
<a name="l00957"></a>00957 <span class="preprocessor"></span>
<a name="l00959"></a><a class="code" href="group__DBusString.html#gd13077c6ef8f8b764611ef5ad23b4b8b">00959</a> <span class="preprocessor">#define ASSIGN_8_OCTETS(p, octets) \</span>
<a name="l00960"></a>00960 <span class="preprocessor">  *((dbus_uint64_t*)(p)) = *((dbus_uint64_t*)(octets));</span>
<a name="l00961"></a>00961 <span class="preprocessor"></span>
<a name="l00971"></a>00971 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00972"></a><a class="code" href="group__DBusString.html#ge7770fdabda32f3e8d9dd50b083dbf1e">00972</a> <a class="code" href="group__DBusString.html#ge7770fdabda32f3e8d9dd50b083dbf1e">_dbus_string_insert_2_aligned</a> (<a class="code" href="structDBusString.html">DBusString</a>         *str,
<a name="l00973"></a>00973                                <span class="keywordtype">int</span>                 insert_at,
<a name="l00974"></a>00974                                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> octets[2])
<a name="l00975"></a>00975 {
<a name="l00976"></a>00976   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l00977"></a>00977   
<a name="l00978"></a>00978   <span class="keywordflow">if</span> (!align_insert_point_then_open_gap (str, &amp;insert_at, 2, 2))
<a name="l00979"></a>00979     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00980"></a>00980 
<a name="l00981"></a>00981   <a class="code" href="group__DBusString.html#g4661e2b10dd3da080564b1191acb7619">ASSIGN_2_OCTETS</a> (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> + insert_at, octets);
<a name="l00982"></a>00982 
<a name="l00983"></a>00983   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00984"></a>00984 }
<a name="l00985"></a>00985 
<a name="l00995"></a>00995 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l00996"></a><a class="code" href="group__DBusString.html#gdd296cf1e6af18cb5bec438e9d353b4e">00996</a> <a class="code" href="group__DBusString.html#gdd296cf1e6af18cb5bec438e9d353b4e">_dbus_string_insert_4_aligned</a> (<a class="code" href="structDBusString.html">DBusString</a>         *str,
<a name="l00997"></a>00997                                <span class="keywordtype">int</span>                 insert_at,
<a name="l00998"></a>00998                                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> octets[4])
<a name="l00999"></a>00999 {
<a name="l01000"></a>01000   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l01001"></a>01001   
<a name="l01002"></a>01002   <span class="keywordflow">if</span> (!align_insert_point_then_open_gap (str, &amp;insert_at, 4, 4))
<a name="l01003"></a>01003     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01004"></a>01004 
<a name="l01005"></a>01005   <a class="code" href="group__DBusString.html#ge777c8fb39aef558604506d645af6420">ASSIGN_4_OCTETS</a> (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> + insert_at, octets);
<a name="l01006"></a>01006 
<a name="l01007"></a>01007   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01008"></a>01008 }
<a name="l01009"></a>01009 
<a name="l01019"></a>01019 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l01020"></a><a class="code" href="group__DBusString.html#g108d7d64fb88fffca31e33181cefa232">01020</a> <a class="code" href="group__DBusString.html#g108d7d64fb88fffca31e33181cefa232">_dbus_string_insert_8_aligned</a> (<a class="code" href="structDBusString.html">DBusString</a>         *str,
<a name="l01021"></a>01021                                <span class="keywordtype">int</span>                 insert_at,
<a name="l01022"></a>01022                                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> octets[8])
<a name="l01023"></a>01023 {
<a name="l01024"></a>01024   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l01025"></a>01025   
<a name="l01026"></a>01026   <span class="keywordflow">if</span> (!align_insert_point_then_open_gap (str, &amp;insert_at, 8, 8))
<a name="l01027"></a>01027     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01028"></a>01028 
<a name="l01029"></a>01029   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (_DBUS_ALIGN_VALUE (insert_at, 8) == (<span class="keywordtype">unsigned</span>) insert_at);
<a name="l01030"></a>01030   
<a name="l01031"></a>01031   <a class="code" href="group__DBusString.html#gd13077c6ef8f8b764611ef5ad23b4b8b">ASSIGN_8_OCTETS</a> (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> + insert_at, octets);
<a name="l01032"></a>01032 
<a name="l01033"></a>01033   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01034"></a>01034 }
<a name="l01035"></a>01035 
<a name="l01036"></a>01036 
<a name="l01047"></a>01047 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l01048"></a><a class="code" href="group__DBusString.html#g267217e412c74c74dc3a3e412da5c600">01048</a> <a class="code" href="group__DBusString.html#g267217e412c74c74dc3a3e412da5c600">_dbus_string_insert_alignment</a> (<a class="code" href="structDBusString.html">DBusString</a>        *str,
<a name="l01049"></a>01049                                <span class="keywordtype">int</span>               *insert_at,
<a name="l01050"></a>01050                                <span class="keywordtype">int</span>                alignment)
<a name="l01051"></a>01051 {
<a name="l01052"></a>01052   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l01053"></a>01053   
<a name="l01054"></a>01054   <span class="keywordflow">if</span> (!align_insert_point_then_open_gap (str, insert_at, alignment, 0))
<a name="l01055"></a>01055     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01056"></a>01056 
<a name="l01057"></a>01057   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (_DBUS_ALIGN_VALUE (*insert_at, alignment) == (<span class="keywordtype">unsigned</span>) *insert_at);
<a name="l01058"></a>01058 
<a name="l01059"></a>01059   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01060"></a>01060 }
<a name="l01061"></a>01061 
<a name="l01071"></a>01071 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l01072"></a><a class="code" href="group__DBusString.html#g8d794f292831d1a7edeb971b13a2c641">01072</a> <a class="code" href="group__DBusString.html#g8d794f292831d1a7edeb971b13a2c641">_dbus_string_append_printf_valist</a>  (<a class="code" href="structDBusString.html">DBusString</a>        *str,
<a name="l01073"></a>01073                                     <span class="keyword">const</span> <span class="keywordtype">char</span>        *format,
<a name="l01074"></a>01074                                     va_list            args)
<a name="l01075"></a>01075 {
<a name="l01076"></a>01076   <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a> ret = <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01077"></a>01077   <span class="keywordtype">int</span> len;
<a name="l01078"></a>01078   va_list args_copy;
<a name="l01079"></a>01079 
<a name="l01080"></a>01080   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l01081"></a>01081 
<a name="l01082"></a>01082   DBUS_VA_COPY (args_copy, args);
<a name="l01083"></a>01083 
<a name="l01084"></a>01084   <span class="comment">/* Measure the message length without terminating nul */</span>
<a name="l01085"></a>01085   len = <a class="code" href="group__DBusSysdeps.html#gab04975b7eadfe5744f11b4682bb46b4">_dbus_printf_string_upper_bound</a> (format, args);
<a name="l01086"></a>01086 
<a name="l01087"></a>01087   <span class="keywordflow">if</span> (len &lt; 0)
<a name="l01088"></a>01088     <span class="keywordflow">goto</span> out;
<a name="l01089"></a>01089 
<a name="l01090"></a>01090   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#g8f13997d90ceed2f437706e6b7804d9b">_dbus_string_lengthen</a> (str, len))
<a name="l01091"></a>01091     {
<a name="l01092"></a>01092       <span class="keywordflow">goto</span> out;
<a name="l01093"></a>01093     }
<a name="l01094"></a>01094   
<a name="l01095"></a>01095   vsprintf ((<span class="keywordtype">char</span>*) (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> + (real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> - len)),
<a name="l01096"></a>01096             format, args_copy);
<a name="l01097"></a>01097   ret = <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01098"></a>01098 
<a name="l01099"></a>01099 out:
<a name="l01100"></a>01100   va_end (args_copy);
<a name="l01101"></a>01101 
<a name="l01102"></a>01102   <span class="keywordflow">return</span> ret;
<a name="l01103"></a>01103 }
<a name="l01104"></a>01104 
<a name="l01113"></a>01113 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l01114"></a><a class="code" href="group__DBusString.html#gb0078cf7e0e5bd784ec6d6e0cc3923a2">01114</a> <a class="code" href="group__DBusString.html#gb0078cf7e0e5bd784ec6d6e0cc3923a2">_dbus_string_append_printf</a> (<a class="code" href="structDBusString.html">DBusString</a>        *str,
<a name="l01115"></a>01115                             <span class="keyword">const</span> <span class="keywordtype">char</span>        *format,
<a name="l01116"></a>01116                             ...)
<a name="l01117"></a>01117 {
<a name="l01118"></a>01118   va_list args;
<a name="l01119"></a>01119   <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a> retval;
<a name="l01120"></a>01120   
<a name="l01121"></a>01121   va_start (args, format);
<a name="l01122"></a>01122   retval = <a class="code" href="group__DBusString.html#g8d794f292831d1a7edeb971b13a2c641">_dbus_string_append_printf_valist</a> (str, format, args);
<a name="l01123"></a>01123   va_end (args);
<a name="l01124"></a>01124 
<a name="l01125"></a>01125   <span class="keywordflow">return</span> retval;
<a name="l01126"></a>01126 }
<a name="l01127"></a>01127 
<a name="l01136"></a>01136 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l01137"></a><a class="code" href="group__DBusString.html#g724656b7091b910965bd1af42d0b7bab">01137</a> <a class="code" href="group__DBusString.html#g724656b7091b910965bd1af42d0b7bab">_dbus_string_append_len</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l01138"></a>01138                          <span class="keyword">const</span> <span class="keywordtype">char</span> *buffer,
<a name="l01139"></a>01139                          <span class="keywordtype">int</span>         len)
<a name="l01140"></a>01140 {
<a name="l01141"></a>01141   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l01142"></a>01142   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (buffer != <a class="code" href="group__DBusMacros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01143"></a>01143   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &gt;= 0);
<a name="l01144"></a>01144 
<a name="l01145"></a>01145   <span class="keywordflow">return</span> append (real, buffer, len);
<a name="l01146"></a>01146 }
<a name="l01147"></a>01147 
<a name="l01156"></a>01156 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l01157"></a><a class="code" href="group__DBusString.html#ga6ecf36e70263659f921a4ef0335db12">01157</a> <a class="code" href="group__DBusString.html#ga6ecf36e70263659f921a4ef0335db12">_dbus_string_append_byte</a> (<a class="code" href="structDBusString.html">DBusString</a>    *str,
<a name="l01158"></a>01158                           <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>  byte)
<a name="l01159"></a>01159 {
<a name="l01160"></a>01160   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l01161"></a>01161 
<a name="l01162"></a>01162   <span class="keywordflow">if</span> (!set_length (real, real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> + 1))
<a name="l01163"></a>01163     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01164"></a>01164 
<a name="l01165"></a>01165   real-&gt;str[real-&gt;len-1] = byte;
<a name="l01166"></a>01166 
<a name="l01167"></a>01167   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01168"></a>01168 }
<a name="l01169"></a>01169 
<a name="l01170"></a>01170 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01171"></a>01171 <span class="keyword">delete</span> (<a class="code" href="structDBusRealString.html">DBusRealString</a> *real,
<a name="l01172"></a>01172         <span class="keywordtype">int</span>             start,
<a name="l01173"></a>01173         <span class="keywordtype">int</span>             len)
<a name="l01174"></a>01174 {
<a name="l01175"></a>01175   <span class="keywordflow">if</span> (len == 0)
<a name="l01176"></a>01176     <span class="keywordflow">return</span>;
<a name="l01177"></a>01177   
<a name="l01178"></a>01178   memmove (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> + start, real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> + start + len, real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> - (start + len));
<a name="l01179"></a>01179   real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> -= len;
<a name="l01180"></a>01180   real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>[real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a>] = <span class="charliteral">'\0'</span>;
<a name="l01181"></a>01181 }
<a name="l01182"></a>01182 
<a name="l01192"></a>01192 <span class="keywordtype">void</span>
<a name="l01193"></a><a class="code" href="group__DBusString.html#g7e0e164ad5bb094e5ccad9edc7ae4235">01193</a> <a class="code" href="group__DBusString.html#g7e0e164ad5bb094e5ccad9edc7ae4235">_dbus_string_delete</a> (<a class="code" href="structDBusString.html">DBusString</a>       *str,
<a name="l01194"></a>01194                      <span class="keywordtype">int</span>               start,
<a name="l01195"></a>01195                      <span class="keywordtype">int</span>               len)
<a name="l01196"></a>01196 {
<a name="l01197"></a>01197   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l01198"></a>01198   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &gt;= 0);
<a name="l01199"></a>01199   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &gt;= 0);
<a name="l01200"></a>01200   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &lt;= real-&gt;len);
<a name="l01201"></a>01201   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &lt;= real-&gt;len - start);
<a name="l01202"></a>01202   
<a name="l01203"></a>01203   <span class="keyword">delete</span> (real, start, len);
<a name="l01204"></a>01204 }
<a name="l01205"></a>01205 
<a name="l01206"></a>01206 <span class="keyword">static</span> <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l01207"></a>01207 copy (<a class="code" href="structDBusRealString.html">DBusRealString</a> *source,
<a name="l01208"></a>01208       <span class="keywordtype">int</span>             start,
<a name="l01209"></a>01209       <span class="keywordtype">int</span>             len,
<a name="l01210"></a>01210       <a class="code" href="structDBusRealString.html">DBusRealString</a> *dest,
<a name="l01211"></a>01211       <span class="keywordtype">int</span>             insert_at)
<a name="l01212"></a>01212 {
<a name="l01213"></a>01213   <span class="keywordflow">if</span> (len == 0)
<a name="l01214"></a>01214     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01215"></a>01215 
<a name="l01216"></a>01216   <span class="keywordflow">if</span> (!open_gap (len, dest, insert_at))
<a name="l01217"></a>01217     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01218"></a>01218   
<a name="l01219"></a>01219   memmove (dest-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> + insert_at,
<a name="l01220"></a>01220            source-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> + start,
<a name="l01221"></a>01221            len);
<a name="l01222"></a>01222 
<a name="l01223"></a>01223   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01224"></a>01224 }
<a name="l01225"></a>01225 
<a name="l01235"></a><a class="code" href="group__DBusString.html#gacbbd102b66aa34dd13f792e7f08c205">01235</a> <span class="preprocessor">#define DBUS_STRING_COPY_PREAMBLE(source, start, dest, insert_at)       \</span>
<a name="l01236"></a>01236 <span class="preprocessor">  DBusRealString *real_source = (DBusRealString*) source;               \</span>
<a name="l01237"></a>01237 <span class="preprocessor">  DBusRealString *real_dest = (DBusRealString*) dest;                   \</span>
<a name="l01238"></a>01238 <span class="preprocessor">  _dbus_assert ((source) != (dest));                                    \</span>
<a name="l01239"></a>01239 <span class="preprocessor">  DBUS_GENERIC_STRING_PREAMBLE (real_source);                           \</span>
<a name="l01240"></a>01240 <span class="preprocessor">  DBUS_GENERIC_STRING_PREAMBLE (real_dest);                             \</span>
<a name="l01241"></a>01241 <span class="preprocessor">  _dbus_assert (!real_dest-&gt;constant);                                  \</span>
<a name="l01242"></a>01242 <span class="preprocessor">  _dbus_assert (!real_dest-&gt;locked);                                    \</span>
<a name="l01243"></a>01243 <span class="preprocessor">  _dbus_assert ((start) &gt;= 0);                                          \</span>
<a name="l01244"></a>01244 <span class="preprocessor">  _dbus_assert ((start) &lt;= real_source-&gt;len);                           \</span>
<a name="l01245"></a>01245 <span class="preprocessor">  _dbus_assert ((insert_at) &gt;= 0);                                      \</span>
<a name="l01246"></a>01246 <span class="preprocessor">  _dbus_assert ((insert_at) &lt;= real_dest-&gt;len)</span>
<a name="l01247"></a>01247 <span class="preprocessor"></span>
<a name="l01258"></a>01258 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l01259"></a><a class="code" href="group__DBusString.html#gd379fce8d4ef4f7e28f81f50b46ee4c9">01259</a> <a class="code" href="group__DBusString.html#gd379fce8d4ef4f7e28f81f50b46ee4c9">_dbus_string_move</a> (<a class="code" href="structDBusString.html">DBusString</a>       *source,
<a name="l01260"></a>01260                    <span class="keywordtype">int</span>               start,
<a name="l01261"></a>01261                    <a class="code" href="structDBusString.html">DBusString</a>       *dest,
<a name="l01262"></a>01262                    <span class="keywordtype">int</span>               insert_at)
<a name="l01263"></a>01263 {
<a name="l01264"></a>01264   <a class="code" href="structDBusRealString.html">DBusRealString</a> *real_source = (<a class="code" href="structDBusRealString.html">DBusRealString</a>*) source;
<a name="l01265"></a>01265   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &lt;= real_source-&gt;len);
<a name="l01266"></a>01266   
<a name="l01267"></a>01267   <span class="keywordflow">return</span> <a class="code" href="group__DBusString.html#gb8e2dcb2dc71bf225da0827c6086a727">_dbus_string_move_len</a> (source, start,
<a name="l01268"></a>01268                                 real_source-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> - start,
<a name="l01269"></a>01269                                 dest, insert_at);
<a name="l01270"></a>01270 }
<a name="l01271"></a>01271 
<a name="l01282"></a>01282 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l01283"></a><a class="code" href="group__DBusString.html#g3c10f0d1bcaa3b450025b9c6a8b901d7">01283</a> <a class="code" href="group__DBusString.html#g3c10f0d1bcaa3b450025b9c6a8b901d7">_dbus_string_copy</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *source,
<a name="l01284"></a>01284                    <span class="keywordtype">int</span>               start,
<a name="l01285"></a>01285                    <a class="code" href="structDBusString.html">DBusString</a>       *dest,
<a name="l01286"></a>01286                    <span class="keywordtype">int</span>               insert_at)
<a name="l01287"></a>01287 {
<a name="l01288"></a>01288   <a class="code" href="group__DBusString.html#gacbbd102b66aa34dd13f792e7f08c205">DBUS_STRING_COPY_PREAMBLE</a> (source, start, dest, insert_at);
<a name="l01289"></a>01289 
<a name="l01290"></a>01290   <span class="keywordflow">return</span> copy (real_source, start,
<a name="l01291"></a>01291                real_source-&gt;len - start,
<a name="l01292"></a>01292                real_dest,
<a name="l01293"></a>01293                insert_at);
<a name="l01294"></a>01294 }
<a name="l01295"></a>01295 
<a name="l01307"></a>01307 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l01308"></a><a class="code" href="group__DBusString.html#gb8e2dcb2dc71bf225da0827c6086a727">01308</a> <a class="code" href="group__DBusString.html#gb8e2dcb2dc71bf225da0827c6086a727">_dbus_string_move_len</a> (<a class="code" href="structDBusString.html">DBusString</a>       *source,
<a name="l01309"></a>01309                        <span class="keywordtype">int</span>               start,
<a name="l01310"></a>01310                        <span class="keywordtype">int</span>               len,
<a name="l01311"></a>01311                        <a class="code" href="structDBusString.html">DBusString</a>       *dest,
<a name="l01312"></a>01312                        <span class="keywordtype">int</span>               insert_at)
<a name="l01313"></a>01313 
<a name="l01314"></a>01314 {
<a name="l01315"></a>01315   <a class="code" href="group__DBusString.html#gacbbd102b66aa34dd13f792e7f08c205">DBUS_STRING_COPY_PREAMBLE</a> (source, start, dest, insert_at);
<a name="l01316"></a>01316   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &gt;= 0);
<a name="l01317"></a>01317   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> ((start + len) &lt;= real_source-&gt;len);
<a name="l01318"></a>01318 
<a name="l01319"></a>01319 
<a name="l01320"></a>01320   <span class="keywordflow">if</span> (len == 0)
<a name="l01321"></a>01321     {
<a name="l01322"></a>01322       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01323"></a>01323     }
<a name="l01324"></a>01324   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (start == 0 &amp;&amp;
<a name="l01325"></a>01325            len == real_source-&gt;len &amp;&amp;
<a name="l01326"></a>01326            real_dest-&gt;len == 0)
<a name="l01327"></a>01327     {
<a name="l01328"></a>01328       <span class="comment">/* Short-circuit moving an entire existing string to an empty string</span>
<a name="l01329"></a>01329 <span class="comment">       * by just swapping the buffers.</span>
<a name="l01330"></a>01330 <span class="comment">       */</span>
<a name="l01331"></a>01331       <span class="comment">/* we assume -&gt;constant doesn't matter as you can't have</span>
<a name="l01332"></a>01332 <span class="comment">       * a constant string involved in a move.</span>
<a name="l01333"></a>01333 <span class="comment">       */</span>
<a name="l01334"></a>01334 <span class="preprocessor">#define ASSIGN_DATA(a, b) do {                  \</span>
<a name="l01335"></a>01335 <span class="preprocessor">        (a)-&gt;str = (b)-&gt;str;                    \</span>
<a name="l01336"></a>01336 <span class="preprocessor">        (a)-&gt;len = (b)-&gt;len;                    \</span>
<a name="l01337"></a>01337 <span class="preprocessor">        (a)-&gt;allocated = (b)-&gt;allocated;        \</span>
<a name="l01338"></a>01338 <span class="preprocessor">        (a)-&gt;align_offset = (b)-&gt;align_offset;  \</span>
<a name="l01339"></a>01339 <span class="preprocessor">      } while (0)</span>
<a name="l01340"></a>01340 <span class="preprocessor"></span>      
<a name="l01341"></a>01341       <a class="code" href="structDBusRealString.html">DBusRealString</a> tmp;
<a name="l01342"></a>01342 
<a name="l01343"></a>01343       ASSIGN_DATA (&amp;tmp, real_source);
<a name="l01344"></a>01344       ASSIGN_DATA (real_source, real_dest);
<a name="l01345"></a>01345       ASSIGN_DATA (real_dest, &amp;tmp);
<a name="l01346"></a>01346 
<a name="l01347"></a>01347       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01348"></a>01348     }
<a name="l01349"></a>01349   <span class="keywordflow">else</span>
<a name="l01350"></a>01350     {
<a name="l01351"></a>01351       <span class="keywordflow">if</span> (!copy (real_source, start, len,
<a name="l01352"></a>01352                  real_dest,
<a name="l01353"></a>01353                  insert_at))
<a name="l01354"></a>01354         <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01355"></a>01355       
<a name="l01356"></a>01356       <span class="keyword">delete</span> (real_source, start,
<a name="l01357"></a>01357               len);
<a name="l01358"></a>01358       
<a name="l01359"></a>01359       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01360"></a>01360     }
<a name="l01361"></a>01361 }
<a name="l01362"></a>01362 
<a name="l01374"></a>01374 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l01375"></a><a class="code" href="group__DBusString.html#gf5f13bc7ac7a623516930d26ae2589bf">01375</a> <a class="code" href="group__DBusString.html#gf5f13bc7ac7a623516930d26ae2589bf">_dbus_string_copy_len</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *source,
<a name="l01376"></a>01376                        <span class="keywordtype">int</span>               start,
<a name="l01377"></a>01377                        <span class="keywordtype">int</span>               len,
<a name="l01378"></a>01378                        <a class="code" href="structDBusString.html">DBusString</a>       *dest,
<a name="l01379"></a>01379                        <span class="keywordtype">int</span>               insert_at)
<a name="l01380"></a>01380 {
<a name="l01381"></a>01381   <a class="code" href="group__DBusString.html#gacbbd102b66aa34dd13f792e7f08c205">DBUS_STRING_COPY_PREAMBLE</a> (source, start, dest, insert_at);
<a name="l01382"></a>01382   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &gt;= 0);
<a name="l01383"></a>01383   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &lt;= real_source-&gt;len);
<a name="l01384"></a>01384   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &lt;= real_source-&gt;len - start);
<a name="l01385"></a>01385   
<a name="l01386"></a>01386   <span class="keywordflow">return</span> copy (real_source, start, len,
<a name="l01387"></a>01387                real_dest,
<a name="l01388"></a>01388                insert_at);
<a name="l01389"></a>01389 }
<a name="l01390"></a>01390 
<a name="l01403"></a>01403 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l01404"></a><a class="code" href="group__DBusString.html#gfe7921a92467cdefaa0a7829d6cf260b">01404</a> <a class="code" href="group__DBusString.html#gfe7921a92467cdefaa0a7829d6cf260b">_dbus_string_replace_len</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *source,
<a name="l01405"></a>01405                           <span class="keywordtype">int</span>               start,
<a name="l01406"></a>01406                           <span class="keywordtype">int</span>               len,
<a name="l01407"></a>01407                           <a class="code" href="structDBusString.html">DBusString</a>       *dest,
<a name="l01408"></a>01408                           <span class="keywordtype">int</span>               replace_at,
<a name="l01409"></a>01409                           <span class="keywordtype">int</span>               replace_len)
<a name="l01410"></a>01410 {
<a name="l01411"></a>01411   <a class="code" href="group__DBusString.html#gacbbd102b66aa34dd13f792e7f08c205">DBUS_STRING_COPY_PREAMBLE</a> (source, start, dest, replace_at);
<a name="l01412"></a>01412   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &gt;= 0);
<a name="l01413"></a>01413   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &lt;= real_source-&gt;len);
<a name="l01414"></a>01414   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &lt;= real_source-&gt;len - start);
<a name="l01415"></a>01415   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (replace_at &gt;= 0);
<a name="l01416"></a>01416   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (replace_at &lt;= real_dest-&gt;len);
<a name="l01417"></a>01417   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (replace_len &lt;= real_dest-&gt;len - replace_at);
<a name="l01418"></a>01418 
<a name="l01419"></a>01419   <span class="keywordflow">if</span> (len == replace_len)
<a name="l01420"></a>01420     {
<a name="l01421"></a>01421       memmove (real_dest-&gt;str + replace_at,
<a name="l01422"></a>01422                real_source-&gt;str + start, len);
<a name="l01423"></a>01423     }
<a name="l01424"></a>01424   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len &lt; replace_len)
<a name="l01425"></a>01425     {
<a name="l01426"></a>01426       memmove (real_dest-&gt;str + replace_at,
<a name="l01427"></a>01427                real_source-&gt;str + start, len);
<a name="l01428"></a>01428       <span class="keyword">delete</span> (real_dest, replace_at + len,
<a name="l01429"></a>01429               replace_len - len);
<a name="l01430"></a>01430     }
<a name="l01431"></a>01431   <span class="keywordflow">else</span>
<a name="l01432"></a>01432     {
<a name="l01433"></a>01433       <span class="keywordtype">int</span> diff;
<a name="l01434"></a>01434 
<a name="l01435"></a>01435       <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &gt; replace_len);
<a name="l01436"></a>01436 
<a name="l01437"></a>01437       diff = len - replace_len;
<a name="l01438"></a>01438 
<a name="l01439"></a>01439       <span class="comment">/* First of all we check if destination string can be enlarged as</span>
<a name="l01440"></a>01440 <span class="comment">       * required, then we overwrite previous bytes</span>
<a name="l01441"></a>01441 <span class="comment">       */</span>
<a name="l01442"></a>01442 
<a name="l01443"></a>01443       <span class="keywordflow">if</span> (!copy (real_source, start + replace_len, diff,
<a name="l01444"></a>01444                  real_dest, replace_at + replace_len))
<a name="l01445"></a>01445         <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01446"></a>01446 
<a name="l01447"></a>01447       memmove (real_dest-&gt;str + replace_at,
<a name="l01448"></a>01448                real_source-&gt;str + start, replace_len);
<a name="l01449"></a>01449     }
<a name="l01450"></a>01450 
<a name="l01451"></a>01451   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01452"></a>01452 }
<a name="l01453"></a>01453 
<a name="l01466"></a>01466 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l01467"></a><a class="code" href="group__DBusString.html#g5d293b49b6afbbd74069d0823acce6b5">01467</a> <a class="code" href="group__DBusString.html#g5d293b49b6afbbd74069d0823acce6b5">_dbus_string_split_on_byte</a> (<a class="code" href="structDBusString.html">DBusString</a>        *source,
<a name="l01468"></a>01468                             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>      byte,
<a name="l01469"></a>01469                             <a class="code" href="structDBusString.html">DBusString</a>        *tail)
<a name="l01470"></a>01470 {
<a name="l01471"></a>01471   <span class="keywordtype">int</span> byte_position;
<a name="l01472"></a>01472   <span class="keywordtype">char</span> byte_string[2] = <span class="stringliteral">""</span>;
<a name="l01473"></a>01473   <span class="keywordtype">int</span> head_length;
<a name="l01474"></a>01474   <span class="keywordtype">int</span> tail_length;
<a name="l01475"></a>01475 
<a name="l01476"></a>01476   byte_string[0] = (char) byte;
<a name="l01477"></a>01477 
<a name="l01478"></a>01478   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#g5fe47873b2838339107c3e1f03d1a703">_dbus_string_find</a> (source, 0, byte_string, &amp;byte_position))
<a name="l01479"></a>01479     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01480"></a>01480 
<a name="l01481"></a>01481   head_length = byte_position;
<a name="l01482"></a>01482   tail_length = _dbus_string_get_length (source) - head_length - 1;
<a name="l01483"></a>01483 
<a name="l01484"></a>01484   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#gb8e2dcb2dc71bf225da0827c6086a727">_dbus_string_move_len</a> (source, byte_position + 1, tail_length,
<a name="l01485"></a>01485                               tail, 0))
<a name="l01486"></a>01486     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01487"></a>01487 
<a name="l01488"></a>01488   <span class="comment">/* remove the trailing delimiter byte from the head now.</span>
<a name="l01489"></a>01489 <span class="comment">   */</span>
<a name="l01490"></a>01490   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#g08c423b93c28dd746dcb93e0461ab95c">_dbus_string_set_length</a> (source, head_length))
<a name="l01491"></a>01491     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01492"></a>01492 
<a name="l01493"></a>01493   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01494"></a>01494 }
<a name="l01495"></a>01495 
<a name="l01496"></a>01496 <span class="comment">/* Unicode macros and utf8_validate() from GLib Owen Taylor, Havoc</span>
<a name="l01497"></a>01497 <span class="comment"> * Pennington, and Tom Tromey are the authors and authorized relicense.</span>
<a name="l01498"></a>01498 <span class="comment"> */</span>
<a name="l01499"></a>01499 
<a name="l01505"></a><a class="code" href="group__DBusString.html#g30614080229a4fb63460ffdc8ab484fb">01505</a> <span class="preprocessor">#define UTF8_COMPUTE(Char, Mask, Len)                                         \</span>
<a name="l01506"></a>01506 <span class="preprocessor">  if (Char &lt; 128)                                                             \</span>
<a name="l01507"></a>01507 <span class="preprocessor">    {                                                                         \</span>
<a name="l01508"></a>01508 <span class="preprocessor">      Len = 1;                                                                \</span>
<a name="l01509"></a>01509 <span class="preprocessor">      Mask = 0x7f;                                                            \</span>
<a name="l01510"></a>01510 <span class="preprocessor">    }                                                                         \</span>
<a name="l01511"></a>01511 <span class="preprocessor">  else if ((Char &amp; 0xe0) == 0xc0)                                             \</span>
<a name="l01512"></a>01512 <span class="preprocessor">    {                                                                         \</span>
<a name="l01513"></a>01513 <span class="preprocessor">      Len = 2;                                                                \</span>
<a name="l01514"></a>01514 <span class="preprocessor">      Mask = 0x1f;                                                            \</span>
<a name="l01515"></a>01515 <span class="preprocessor">    }                                                                         \</span>
<a name="l01516"></a>01516 <span class="preprocessor">  else if ((Char &amp; 0xf0) == 0xe0)                                             \</span>
<a name="l01517"></a>01517 <span class="preprocessor">    {                                                                         \</span>
<a name="l01518"></a>01518 <span class="preprocessor">      Len = 3;                                                                \</span>
<a name="l01519"></a>01519 <span class="preprocessor">      Mask = 0x0f;                                                            \</span>
<a name="l01520"></a>01520 <span class="preprocessor">    }                                                                         \</span>
<a name="l01521"></a>01521 <span class="preprocessor">  else if ((Char &amp; 0xf8) == 0xf0)                                             \</span>
<a name="l01522"></a>01522 <span class="preprocessor">    {                                                                         \</span>
<a name="l01523"></a>01523 <span class="preprocessor">      Len = 4;                                                                \</span>
<a name="l01524"></a>01524 <span class="preprocessor">      Mask = 0x07;                                                            \</span>
<a name="l01525"></a>01525 <span class="preprocessor">    }                                                                         \</span>
<a name="l01526"></a>01526 <span class="preprocessor">  else if ((Char &amp; 0xfc) == 0xf8)                                             \</span>
<a name="l01527"></a>01527 <span class="preprocessor">    {                                                                         \</span>
<a name="l01528"></a>01528 <span class="preprocessor">      Len = 5;                                                                \</span>
<a name="l01529"></a>01529 <span class="preprocessor">      Mask = 0x03;                                                            \</span>
<a name="l01530"></a>01530 <span class="preprocessor">    }                                                                         \</span>
<a name="l01531"></a>01531 <span class="preprocessor">  else if ((Char &amp; 0xfe) == 0xfc)                                             \</span>
<a name="l01532"></a>01532 <span class="preprocessor">    {                                                                         \</span>
<a name="l01533"></a>01533 <span class="preprocessor">      Len = 6;                                                                \</span>
<a name="l01534"></a>01534 <span class="preprocessor">      Mask = 0x01;                                                            \</span>
<a name="l01535"></a>01535 <span class="preprocessor">    }                                                                         \</span>
<a name="l01536"></a>01536 <span class="preprocessor">  else                                                                        \</span>
<a name="l01537"></a>01537 <span class="preprocessor">    {                                                                         \</span>
<a name="l01538"></a>01538 <span class="preprocessor">      Len = 0;                                                               \</span>
<a name="l01539"></a>01539 <span class="preprocessor">      Mask = 0;                                                               \</span>
<a name="l01540"></a>01540 <span class="preprocessor">    }</span>
<a name="l01541"></a>01541 <span class="preprocessor"></span>
<a name="l01546"></a><a class="code" href="group__DBusString.html#g9691ff5386e218870299de1d9e77ceea">01546</a> <span class="preprocessor">#define UTF8_LENGTH(Char)              \</span>
<a name="l01547"></a>01547 <span class="preprocessor">  ((Char) &lt; 0x80 ? 1 :                 \</span>
<a name="l01548"></a>01548 <span class="preprocessor">   ((Char) &lt; 0x800 ? 2 :               \</span>
<a name="l01549"></a>01549 <span class="preprocessor">    ((Char) &lt; 0x10000 ? 3 :            \</span>
<a name="l01550"></a>01550 <span class="preprocessor">     ((Char) &lt; 0x200000 ? 4 :          \</span>
<a name="l01551"></a>01551 <span class="preprocessor">      ((Char) &lt; 0x4000000 ? 5 : 6)))))</span>
<a name="l01552"></a>01552 <span class="preprocessor"></span>   
<a name="l01562"></a><a class="code" href="group__DBusString.html#gb5b4b316a69f78611a14e6b1fd091992">01562</a> <span class="preprocessor">#define UTF8_GET(Result, Chars, Count, Mask, Len)                             \</span>
<a name="l01563"></a>01563 <span class="preprocessor">  (Result) = (Chars)[0] &amp; (Mask);                                             \</span>
<a name="l01564"></a>01564 <span class="preprocessor">  for ((Count) = 1; (Count) &lt; (Len); ++(Count))                               \</span>
<a name="l01565"></a>01565 <span class="preprocessor">    {                                                                         \</span>
<a name="l01566"></a>01566 <span class="preprocessor">      if (((Chars)[(Count)] &amp; 0xc0) != 0x80)                                  \</span>
<a name="l01567"></a>01567 <span class="preprocessor">        {                                                                     \</span>
<a name="l01568"></a>01568 <span class="preprocessor">          (Result) = -1;                                                      \</span>
<a name="l01569"></a>01569 <span class="preprocessor">          break;                                                              \</span>
<a name="l01570"></a>01570 <span class="preprocessor">        }                                                                     \</span>
<a name="l01571"></a>01571 <span class="preprocessor">      (Result) &lt;&lt;= 6;                                                         \</span>
<a name="l01572"></a>01572 <span class="preprocessor">      (Result) |= ((Chars)[(Count)] &amp; 0x3f);                                  \</span>
<a name="l01573"></a>01573 <span class="preprocessor">    }</span>
<a name="l01574"></a>01574 <span class="preprocessor"></span>
<a name="l01585"></a><a class="code" href="group__DBusString.html#g25f0a93fc023fa0eec07ac1e32011e89">01585</a> <span class="preprocessor">#define UNICODE_VALID(Char)                   \</span>
<a name="l01586"></a>01586 <span class="preprocessor">    ((Char) &lt; 0x110000 &amp;&amp;                     \</span>
<a name="l01587"></a>01587 <span class="preprocessor">     (((Char) &amp; 0xFFFFF800) != 0xD800))</span>
<a name="l01588"></a>01588 <span class="preprocessor"></span>
<a name="l01603"></a>01603 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l01604"></a><a class="code" href="group__DBusString.html#g5fe47873b2838339107c3e1f03d1a703">01604</a> <a class="code" href="group__DBusString.html#g5fe47873b2838339107c3e1f03d1a703">_dbus_string_find</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l01605"></a>01605                    <span class="keywordtype">int</span>               start,
<a name="l01606"></a>01606                    <span class="keyword">const</span> <span class="keywordtype">char</span>       *substr,
<a name="l01607"></a>01607                    <span class="keywordtype">int</span>              *found)
<a name="l01608"></a>01608 {
<a name="l01609"></a>01609   <span class="keywordflow">return</span> <a class="code" href="group__DBusString.html#gf2281731c3119f946726680242a5ae02">_dbus_string_find_to</a> (str, start,
<a name="l01610"></a>01610                                ((<span class="keyword">const</span> <a class="code" href="structDBusRealString.html">DBusRealString</a>*)str)-&gt;len,
<a name="l01611"></a>01611                                substr, found);
<a name="l01612"></a>01612 }
<a name="l01613"></a>01613 
<a name="l01626"></a>01626 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l01627"></a><a class="code" href="group__DBusString.html#g3c98d1913e3ba4deb8eda60b2e262fdb">01627</a> <a class="code" href="group__DBusString.html#g3c98d1913e3ba4deb8eda60b2e262fdb">_dbus_string_find_eol</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l01628"></a>01628                        <span class="keywordtype">int</span>               start,
<a name="l01629"></a>01629                        <span class="keywordtype">int</span>              *found,
<a name="l01630"></a>01630                        <span class="keywordtype">int</span>              *found_len)
<a name="l01631"></a>01631 {
<a name="l01632"></a>01632   <span class="keywordtype">int</span> i;
<a name="l01633"></a>01633 
<a name="l01634"></a>01634   <a class="code" href="group__DBusStringInternals.html#g5cf5f12f6d8f839e9a7c3ad790a83316">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l01635"></a>01635   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &lt;= real-&gt;len);
<a name="l01636"></a>01636   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &gt;= 0);
<a name="l01637"></a>01637   
<a name="l01638"></a>01638   i = start;
<a name="l01639"></a>01639   <span class="keywordflow">while</span> (i &lt; real-&gt;len)
<a name="l01640"></a>01640     {
<a name="l01641"></a>01641       <span class="keywordflow">if</span> (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>[i] == <span class="charliteral">'\r'</span>) 
<a name="l01642"></a>01642         {
<a name="l01643"></a>01643           <span class="keywordflow">if</span> ((i+1) &lt; real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> &amp;&amp; real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>[i+1] == <span class="charliteral">'\n'</span>) <span class="comment">/* "\r\n" */</span>
<a name="l01644"></a>01644             {
<a name="l01645"></a>01645               <span class="keywordflow">if</span> (found) 
<a name="l01646"></a>01646                 *found = i;
<a name="l01647"></a>01647               <span class="keywordflow">if</span> (found_len)
<a name="l01648"></a>01648                 *found_len = 2;
<a name="l01649"></a>01649               <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01650"></a>01650             } 
<a name="l01651"></a>01651           <span class="keywordflow">else</span> <span class="comment">/* only "\r" */</span>
<a name="l01652"></a>01652             {
<a name="l01653"></a>01653               <span class="keywordflow">if</span> (found) 
<a name="l01654"></a>01654                 *found = i;
<a name="l01655"></a>01655               <span class="keywordflow">if</span> (found_len)
<a name="l01656"></a>01656                 *found_len = 1;
<a name="l01657"></a>01657               <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01658"></a>01658             }
<a name="l01659"></a>01659         } 
<a name="l01660"></a>01660       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>[i] == <span class="charliteral">'\n'</span>)  <span class="comment">/* only "\n" */</span>
<a name="l01661"></a>01661         {
<a name="l01662"></a>01662           <span class="keywordflow">if</span> (found) 
<a name="l01663"></a>01663             *found = i;
<a name="l01664"></a>01664           <span class="keywordflow">if</span> (found_len)
<a name="l01665"></a>01665             *found_len = 1;
<a name="l01666"></a>01666           <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01667"></a>01667         }
<a name="l01668"></a>01668       ++i;
<a name="l01669"></a>01669     }
<a name="l01670"></a>01670 
<a name="l01671"></a>01671   <span class="keywordflow">if</span> (found)
<a name="l01672"></a>01672     *found = real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a>;
<a name="l01673"></a>01673 
<a name="l01674"></a>01674   <span class="keywordflow">if</span> (found_len)
<a name="l01675"></a>01675     *found_len = 0;
<a name="l01676"></a>01676   
<a name="l01677"></a>01677   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01678"></a>01678 }
<a name="l01679"></a>01679 
<a name="l01696"></a>01696 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l01697"></a><a class="code" href="group__DBusString.html#gf2281731c3119f946726680242a5ae02">01697</a> <a class="code" href="group__DBusString.html#gf2281731c3119f946726680242a5ae02">_dbus_string_find_to</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l01698"></a>01698                       <span class="keywordtype">int</span>               start,
<a name="l01699"></a>01699                       <span class="keywordtype">int</span>               end,
<a name="l01700"></a>01700                       <span class="keyword">const</span> <span class="keywordtype">char</span>       *substr,
<a name="l01701"></a>01701                       <span class="keywordtype">int</span>              *found)
<a name="l01702"></a>01702 {
<a name="l01703"></a>01703   <span class="keywordtype">int</span> i;
<a name="l01704"></a>01704   <a class="code" href="group__DBusStringInternals.html#g5cf5f12f6d8f839e9a7c3ad790a83316">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l01705"></a>01705   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (substr != <a class="code" href="group__DBusMacros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01706"></a>01706   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &lt;= real-&gt;len);
<a name="l01707"></a>01707   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &gt;= 0);
<a name="l01708"></a>01708   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (substr != <a class="code" href="group__DBusMacros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01709"></a>01709   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (end &lt;= real-&gt;len);
<a name="l01710"></a>01710   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &lt;= end);
<a name="l01711"></a>01711 
<a name="l01712"></a>01712   <span class="comment">/* we always "find" an empty string */</span>
<a name="l01713"></a>01713   <span class="keywordflow">if</span> (*substr == <span class="charliteral">'\0'</span>)
<a name="l01714"></a>01714     {
<a name="l01715"></a>01715       <span class="keywordflow">if</span> (found)
<a name="l01716"></a>01716         *found = start;
<a name="l01717"></a>01717       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01718"></a>01718     }
<a name="l01719"></a>01719 
<a name="l01720"></a>01720   i = start;
<a name="l01721"></a>01721   <span class="keywordflow">while</span> (i &lt; end)
<a name="l01722"></a>01722     {
<a name="l01723"></a>01723       <span class="keywordflow">if</span> (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>[i] == substr[0])
<a name="l01724"></a>01724         {
<a name="l01725"></a>01725           <span class="keywordtype">int</span> j = i + 1;
<a name="l01726"></a>01726           
<a name="l01727"></a>01727           <span class="keywordflow">while</span> (j &lt; end)
<a name="l01728"></a>01728             {
<a name="l01729"></a>01729               <span class="keywordflow">if</span> (substr[j - i] == <span class="charliteral">'\0'</span>)
<a name="l01730"></a>01730                 <span class="keywordflow">break</span>;
<a name="l01731"></a>01731               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>[j] != substr[j - i])
<a name="l01732"></a>01732                 <span class="keywordflow">break</span>;
<a name="l01733"></a>01733               
<a name="l01734"></a>01734               ++j;
<a name="l01735"></a>01735             }
<a name="l01736"></a>01736 
<a name="l01737"></a>01737           <span class="keywordflow">if</span> (substr[j - i] == <span class="charliteral">'\0'</span>)
<a name="l01738"></a>01738             {
<a name="l01739"></a>01739               <span class="keywordflow">if</span> (found)
<a name="l01740"></a>01740                 *found = i;
<a name="l01741"></a>01741               <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01742"></a>01742             }
<a name="l01743"></a>01743         }
<a name="l01744"></a>01744       
<a name="l01745"></a>01745       ++i;
<a name="l01746"></a>01746     }
<a name="l01747"></a>01747 
<a name="l01748"></a>01748   <span class="keywordflow">if</span> (found)
<a name="l01749"></a>01749     *found = end;
<a name="l01750"></a>01750   
<a name="l01751"></a>01751   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;  
<a name="l01752"></a>01752 }
<a name="l01753"></a>01753 
<a name="l01764"></a>01764 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l01765"></a><a class="code" href="group__DBusString.html#g677ddb4246c7e7f67ed3145dc3c1c96b">01765</a> <a class="code" href="group__DBusString.html#g677ddb4246c7e7f67ed3145dc3c1c96b">_dbus_string_find_blank</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l01766"></a>01766                          <span class="keywordtype">int</span>               start,
<a name="l01767"></a>01767                          <span class="keywordtype">int</span>              *found)
<a name="l01768"></a>01768 {
<a name="l01769"></a>01769   <span class="keywordtype">int</span> i;
<a name="l01770"></a>01770   <a class="code" href="group__DBusStringInternals.html#g5cf5f12f6d8f839e9a7c3ad790a83316">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l01771"></a>01771   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &lt;= real-&gt;len);
<a name="l01772"></a>01772   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &gt;= 0);
<a name="l01773"></a>01773   
<a name="l01774"></a>01774   i = start;
<a name="l01775"></a>01775   <span class="keywordflow">while</span> (i &lt; real-&gt;len)
<a name="l01776"></a>01776     {
<a name="l01777"></a>01777       <span class="keywordflow">if</span> (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>[i] == <span class="charliteral">' '</span> ||
<a name="l01778"></a>01778           real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>[i] == <span class="charliteral">'\t'</span>)
<a name="l01779"></a>01779         {
<a name="l01780"></a>01780           <span class="keywordflow">if</span> (found)
<a name="l01781"></a>01781             *found = i;
<a name="l01782"></a>01782           <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01783"></a>01783         }
<a name="l01784"></a>01784       
<a name="l01785"></a>01785       ++i;
<a name="l01786"></a>01786     }
<a name="l01787"></a>01787 
<a name="l01788"></a>01788   <span class="keywordflow">if</span> (found)
<a name="l01789"></a>01789     *found = real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a>;
<a name="l01790"></a>01790   
<a name="l01791"></a>01791   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01792"></a>01792 }
<a name="l01793"></a>01793 
<a name="l01802"></a>01802 <span class="keywordtype">void</span>
<a name="l01803"></a><a class="code" href="group__DBusString.html#g5698b163289be0066cf10c0f1caf877a">01803</a> <a class="code" href="group__DBusString.html#g5698b163289be0066cf10c0f1caf877a">_dbus_string_skip_blank</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l01804"></a>01804                          <span class="keywordtype">int</span>               start,
<a name="l01805"></a>01805                          <span class="keywordtype">int</span>              *end)
<a name="l01806"></a>01806 {
<a name="l01807"></a>01807   <span class="keywordtype">int</span> i;
<a name="l01808"></a>01808   <a class="code" href="group__DBusStringInternals.html#g5cf5f12f6d8f839e9a7c3ad790a83316">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l01809"></a>01809   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &lt;= real-&gt;len);
<a name="l01810"></a>01810   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &gt;= 0);
<a name="l01811"></a>01811   
<a name="l01812"></a>01812   i = start;
<a name="l01813"></a>01813   <span class="keywordflow">while</span> (i &lt; real-&gt;len)
<a name="l01814"></a>01814     {
<a name="l01815"></a>01815       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusStringInternals.html#g8f488964e430c0ae6a1a4204e0098dfe">DBUS_IS_ASCII_BLANK</a> (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>[i]))
<a name="l01816"></a>01816         <span class="keywordflow">break</span>;
<a name="l01817"></a>01817       
<a name="l01818"></a>01818       ++i;
<a name="l01819"></a>01819     }
<a name="l01820"></a>01820 
<a name="l01821"></a>01821   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (i == real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> || !<a class="code" href="group__DBusStringInternals.html#g9c88845804be152df28b81d7cad5673a">DBUS_IS_ASCII_WHITE</a> (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>[i]));
<a name="l01822"></a>01822   
<a name="l01823"></a>01823   <span class="keywordflow">if</span> (end)
<a name="l01824"></a>01824     *end = i;
<a name="l01825"></a>01825 }
<a name="l01826"></a>01826 
<a name="l01827"></a>01827 
<a name="l01836"></a>01836 <span class="keywordtype">void</span>
<a name="l01837"></a><a class="code" href="group__DBusString.html#g8600259d71a4adc14ab4558a9d2a0f7d">01837</a> <a class="code" href="group__DBusString.html#g8600259d71a4adc14ab4558a9d2a0f7d">_dbus_string_skip_white</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l01838"></a>01838                          <span class="keywordtype">int</span>               start,
<a name="l01839"></a>01839                          <span class="keywordtype">int</span>              *end)
<a name="l01840"></a>01840 {
<a name="l01841"></a>01841   <span class="keywordtype">int</span> i;
<a name="l01842"></a>01842   <a class="code" href="group__DBusStringInternals.html#g5cf5f12f6d8f839e9a7c3ad790a83316">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l01843"></a>01843   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &lt;= real-&gt;len);
<a name="l01844"></a>01844   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &gt;= 0);
<a name="l01845"></a>01845   
<a name="l01846"></a>01846   i = start;
<a name="l01847"></a>01847   <span class="keywordflow">while</span> (i &lt; real-&gt;len)
<a name="l01848"></a>01848     {
<a name="l01849"></a>01849       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusStringInternals.html#g9c88845804be152df28b81d7cad5673a">DBUS_IS_ASCII_WHITE</a> (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>[i]))
<a name="l01850"></a>01850         <span class="keywordflow">break</span>;
<a name="l01851"></a>01851       
<a name="l01852"></a>01852       ++i;
<a name="l01853"></a>01853     }
<a name="l01854"></a>01854 
<a name="l01855"></a>01855   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (i == real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> || !(<a class="code" href="group__DBusStringInternals.html#g9c88845804be152df28b81d7cad5673a">DBUS_IS_ASCII_WHITE</a> (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>[i])));
<a name="l01856"></a>01856   
<a name="l01857"></a>01857   <span class="keywordflow">if</span> (end)
<a name="l01858"></a>01858     *end = i;
<a name="l01859"></a>01859 }
<a name="l01860"></a>01860 
<a name="l01869"></a>01869 <span class="keywordtype">void</span>
<a name="l01870"></a><a class="code" href="group__DBusString.html#g578bb88acec5520825f2ba792cad7938">01870</a> <a class="code" href="group__DBusString.html#g578bb88acec5520825f2ba792cad7938">_dbus_string_skip_white_reverse</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l01871"></a>01871                                  <span class="keywordtype">int</span>               end,
<a name="l01872"></a>01872                                  <span class="keywordtype">int</span>              *start)
<a name="l01873"></a>01873 {
<a name="l01874"></a>01874   <span class="keywordtype">int</span> i;
<a name="l01875"></a>01875   <a class="code" href="group__DBusStringInternals.html#g5cf5f12f6d8f839e9a7c3ad790a83316">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l01876"></a>01876   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (end &lt;= real-&gt;len);
<a name="l01877"></a>01877   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (end &gt;= 0);
<a name="l01878"></a>01878   
<a name="l01879"></a>01879   i = end;
<a name="l01880"></a>01880   <span class="keywordflow">while</span> (i &gt; 0)
<a name="l01881"></a>01881     {
<a name="l01882"></a>01882       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusStringInternals.html#g9c88845804be152df28b81d7cad5673a">DBUS_IS_ASCII_WHITE</a> (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>[i-1]))
<a name="l01883"></a>01883         <span class="keywordflow">break</span>;
<a name="l01884"></a>01884       --i;
<a name="l01885"></a>01885     }
<a name="l01886"></a>01886 
<a name="l01887"></a>01887   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (i &gt;= 0 &amp;&amp; (i == 0 || !(<a class="code" href="group__DBusStringInternals.html#g9c88845804be152df28b81d7cad5673a">DBUS_IS_ASCII_WHITE</a> (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>[i-1]))));
<a name="l01888"></a>01888   
<a name="l01889"></a>01889   <span class="keywordflow">if</span> (start)
<a name="l01890"></a>01890     *start = i;
<a name="l01891"></a>01891 }
<a name="l01892"></a>01892 
<a name="l01908"></a>01908 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l01909"></a><a class="code" href="group__DBusString.html#g8b7fc22e6738173e1b2cef4b91b9c3c1">01909</a> <a class="code" href="group__DBusString.html#g8b7fc22e6738173e1b2cef4b91b9c3c1">_dbus_string_pop_line</a> (<a class="code" href="structDBusString.html">DBusString</a> *source,
<a name="l01910"></a>01910                        <a class="code" href="structDBusString.html">DBusString</a> *dest)
<a name="l01911"></a>01911 {
<a name="l01912"></a>01912   <span class="keywordtype">int</span> eol, eol_len;
<a name="l01913"></a>01913   
<a name="l01914"></a>01914   <a class="code" href="group__DBusString.html#g08c423b93c28dd746dcb93e0461ab95c">_dbus_string_set_length</a> (dest, 0);
<a name="l01915"></a>01915   
<a name="l01916"></a>01916   eol = 0;
<a name="l01917"></a>01917   eol_len = 0;
<a name="l01918"></a>01918   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#g3c98d1913e3ba4deb8eda60b2e262fdb">_dbus_string_find_eol</a> (source, 0, &amp;eol, &amp;eol_len))
<a name="l01919"></a>01919     {
<a name="l01920"></a>01920       <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (eol == _dbus_string_get_length (source));
<a name="l01921"></a>01921       <span class="keywordflow">if</span> (eol == 0)
<a name="l01922"></a>01922         {
<a name="l01923"></a>01923           <span class="comment">/* If there's no newline and source has zero length, we're done */</span>
<a name="l01924"></a>01924           <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01925"></a>01925         }
<a name="l01926"></a>01926       <span class="comment">/* otherwise, the last line of the file has no eol characters */</span>
<a name="l01927"></a>01927     }
<a name="l01928"></a>01928 
<a name="l01929"></a>01929   <span class="comment">/* remember eol can be 0 if it's an empty line, but eol_len should not be zero also</span>
<a name="l01930"></a>01930 <span class="comment">   * since find_eol returned TRUE</span>
<a name="l01931"></a>01931 <span class="comment">   */</span>
<a name="l01932"></a>01932   
<a name="l01933"></a>01933   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#gb8e2dcb2dc71bf225da0827c6086a727">_dbus_string_move_len</a> (source, 0, eol + eol_len, dest, 0))
<a name="l01934"></a>01934     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01935"></a>01935   
<a name="l01936"></a>01936   <span class="comment">/* remove line ending */</span>
<a name="l01937"></a>01937   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#g08c423b93c28dd746dcb93e0461ab95c">_dbus_string_set_length</a> (dest, eol))
<a name="l01938"></a>01938     {
<a name="l01939"></a>01939       <a class="code" href="group__DBusInternalsUtils.html#g0c4961ec784874f1b1f3aeccea8d3da1">_dbus_assert_not_reached</a> (<span class="stringliteral">"out of memory when shortening a string"</span>);
<a name="l01940"></a>01940       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01941"></a>01941     }
<a name="l01942"></a>01942 
<a name="l01943"></a>01943   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01944"></a>01944 }
<a name="l01945"></a>01945 
<a name="l01946"></a>01946 <span class="preprocessor">#ifdef DBUS_ENABLE_EMBEDDED_TESTS</span>
<a name="l01947"></a>01947 <span class="preprocessor"></span>
<a name="l01953"></a>01953 <span class="keywordtype">void</span>
<a name="l01954"></a>01954 _dbus_string_delete_first_word (<a class="code" href="structDBusString.html">DBusString</a> *str)
<a name="l01955"></a>01955 {
<a name="l01956"></a>01956   <span class="keywordtype">int</span> i;
<a name="l01957"></a>01957   
<a name="l01958"></a>01958   <span class="keywordflow">if</span> (<a class="code" href="group__DBusString.html#g677ddb4246c7e7f67ed3145dc3c1c96b">_dbus_string_find_blank</a> (str, 0, &amp;i))
<a name="l01959"></a>01959     <a class="code" href="group__DBusString.html#g5698b163289be0066cf10c0f1caf877a">_dbus_string_skip_blank</a> (str, i, &amp;i);
<a name="l01960"></a>01960 
<a name="l01961"></a>01961   <a class="code" href="group__DBusString.html#g7e0e164ad5bb094e5ccad9edc7ae4235">_dbus_string_delete</a> (str, 0, i);
<a name="l01962"></a>01962 }
<a name="l01963"></a>01963 <span class="preprocessor">#endif</span>
<a name="l01964"></a>01964 <span class="preprocessor"></span>
<a name="l01965"></a>01965 <span class="preprocessor">#ifdef DBUS_ENABLE_EMBEDDED_TESTS</span>
<a name="l01966"></a>01966 <span class="preprocessor"></span>
<a name="l01971"></a>01971 <span class="keywordtype">void</span>
<a name="l01972"></a>01972 _dbus_string_delete_leading_blanks (<a class="code" href="structDBusString.html">DBusString</a> *str)
<a name="l01973"></a>01973 {
<a name="l01974"></a>01974   <span class="keywordtype">int</span> i;
<a name="l01975"></a>01975   
<a name="l01976"></a>01976   <a class="code" href="group__DBusString.html#g5698b163289be0066cf10c0f1caf877a">_dbus_string_skip_blank</a> (str, 0, &amp;i);
<a name="l01977"></a>01977 
<a name="l01978"></a>01978   <span class="keywordflow">if</span> (i &gt; 0)
<a name="l01979"></a>01979     <a class="code" href="group__DBusString.html#g7e0e164ad5bb094e5ccad9edc7ae4235">_dbus_string_delete</a> (str, 0, i);
<a name="l01980"></a>01980 }
<a name="l01981"></a>01981 <span class="preprocessor">#endif</span>
<a name="l01982"></a>01982 <span class="preprocessor"></span>
<a name="l01988"></a>01988 <span class="keywordtype">void</span>
<a name="l01989"></a><a class="code" href="group__DBusString.html#ga92c6ab2c5e24cbefef0a3f3fc76f98b">01989</a> <a class="code" href="group__DBusString.html#ga92c6ab2c5e24cbefef0a3f3fc76f98b">_dbus_string_chop_white</a>(<a class="code" href="structDBusString.html">DBusString</a> *str)
<a name="l01990"></a>01990 {
<a name="l01991"></a>01991   <span class="keywordtype">int</span> i;
<a name="l01992"></a>01992   
<a name="l01993"></a>01993   <a class="code" href="group__DBusString.html#g8600259d71a4adc14ab4558a9d2a0f7d">_dbus_string_skip_white</a> (str, 0, &amp;i);
<a name="l01994"></a>01994 
<a name="l01995"></a>01995   <span class="keywordflow">if</span> (i &gt; 0)
<a name="l01996"></a>01996     <a class="code" href="group__DBusString.html#g7e0e164ad5bb094e5ccad9edc7ae4235">_dbus_string_delete</a> (str, 0, i);
<a name="l01997"></a>01997   
<a name="l01998"></a>01998   <a class="code" href="group__DBusString.html#g578bb88acec5520825f2ba792cad7938">_dbus_string_skip_white_reverse</a> (str, _dbus_string_get_length (str), &amp;i);
<a name="l01999"></a>01999 
<a name="l02000"></a>02000   <a class="code" href="group__DBusString.html#g08c423b93c28dd746dcb93e0461ab95c">_dbus_string_set_length</a> (str, i);
<a name="l02001"></a>02001 }
<a name="l02002"></a>02002 
<a name="l02012"></a>02012 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l02013"></a><a class="code" href="group__DBusString.html#gd79c34af55b58f0e8b81ecf11b8694bb">02013</a> <a class="code" href="group__DBusString.html#gd79c34af55b58f0e8b81ecf11b8694bb">_dbus_string_equal</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *a,
<a name="l02014"></a>02014                     <span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *b)
<a name="l02015"></a>02015 {
<a name="l02016"></a>02016   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ap;
<a name="l02017"></a>02017   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *bp;
<a name="l02018"></a>02018   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *a_end;
<a name="l02019"></a>02019   <span class="keyword">const</span> <a class="code" href="structDBusRealString.html">DBusRealString</a> *real_a = (<span class="keyword">const</span> <a class="code" href="structDBusRealString.html">DBusRealString</a>*) a;
<a name="l02020"></a>02020   <span class="keyword">const</span> <a class="code" href="structDBusRealString.html">DBusRealString</a> *real_b = (<span class="keyword">const</span> <a class="code" href="structDBusRealString.html">DBusRealString</a>*) b;
<a name="l02021"></a>02021   <a class="code" href="group__DBusStringInternals.html#g862cb88a139179981e1fcd5643165b56">DBUS_GENERIC_STRING_PREAMBLE</a> (real_a);
<a name="l02022"></a>02022   <a class="code" href="group__DBusStringInternals.html#g862cb88a139179981e1fcd5643165b56">DBUS_GENERIC_STRING_PREAMBLE</a> (real_b);
<a name="l02023"></a>02023 
<a name="l02024"></a>02024   <span class="keywordflow">if</span> (real_a-&gt;len != real_b-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a>)
<a name="l02025"></a>02025     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02026"></a>02026 
<a name="l02027"></a>02027   ap = real_a-&gt;str;
<a name="l02028"></a>02028   bp = real_b-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>;
<a name="l02029"></a>02029   a_end = real_a-&gt;str + real_a-&gt;len;
<a name="l02030"></a>02030   <span class="keywordflow">while</span> (ap != a_end)
<a name="l02031"></a>02031     {
<a name="l02032"></a>02032       <span class="keywordflow">if</span> (*ap != *bp)
<a name="l02033"></a>02033         <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02034"></a>02034       
<a name="l02035"></a>02035       ++ap;
<a name="l02036"></a>02036       ++bp;
<a name="l02037"></a>02037     }
<a name="l02038"></a>02038 
<a name="l02039"></a>02039   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02040"></a>02040 }
<a name="l02041"></a>02041 
<a name="l02055"></a>02055 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l02056"></a><a class="code" href="group__DBusString.html#gcf39727ae9eb411b0c4cb3b891588fb0">02056</a> <a class="code" href="group__DBusString.html#gcf39727ae9eb411b0c4cb3b891588fb0">_dbus_string_equal_len</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *a,
<a name="l02057"></a>02057                         <span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *b,
<a name="l02058"></a>02058                         <span class="keywordtype">int</span>               len)
<a name="l02059"></a>02059 {
<a name="l02060"></a>02060   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ap;
<a name="l02061"></a>02061   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *bp;
<a name="l02062"></a>02062   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *a_end;
<a name="l02063"></a>02063   <span class="keyword">const</span> <a class="code" href="structDBusRealString.html">DBusRealString</a> *real_a = (<span class="keyword">const</span> <a class="code" href="structDBusRealString.html">DBusRealString</a>*) a;
<a name="l02064"></a>02064   <span class="keyword">const</span> <a class="code" href="structDBusRealString.html">DBusRealString</a> *real_b = (<span class="keyword">const</span> <a class="code" href="structDBusRealString.html">DBusRealString</a>*) b;
<a name="l02065"></a>02065   <a class="code" href="group__DBusStringInternals.html#g862cb88a139179981e1fcd5643165b56">DBUS_GENERIC_STRING_PREAMBLE</a> (real_a);
<a name="l02066"></a>02066   <a class="code" href="group__DBusStringInternals.html#g862cb88a139179981e1fcd5643165b56">DBUS_GENERIC_STRING_PREAMBLE</a> (real_b);
<a name="l02067"></a>02067 
<a name="l02068"></a>02068   <span class="keywordflow">if</span> (real_a-&gt;len != real_b-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> &amp;&amp;
<a name="l02069"></a>02069       (real_a-&gt;len &lt; len || real_b-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> &lt; len))
<a name="l02070"></a>02070     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02071"></a>02071 
<a name="l02072"></a>02072   ap = real_a-&gt;str;
<a name="l02073"></a>02073   bp = real_b-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a>;
<a name="l02074"></a>02074   a_end = real_a-&gt;str + MIN (real_a-&gt;len, len);
<a name="l02075"></a>02075   <span class="keywordflow">while</span> (ap != a_end)
<a name="l02076"></a>02076     {
<a name="l02077"></a>02077       <span class="keywordflow">if</span> (*ap != *bp)
<a name="l02078"></a>02078         <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02079"></a>02079       
<a name="l02080"></a>02080       ++ap;
<a name="l02081"></a>02081       ++bp;
<a name="l02082"></a>02082     }
<a name="l02083"></a>02083 
<a name="l02084"></a>02084   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02085"></a>02085 }
<a name="l02086"></a>02086 
<a name="l02103"></a>02103 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l02104"></a><a class="code" href="group__DBusString.html#g2095c2a797ae245521a7588b32279110">02104</a> <a class="code" href="group__DBusString.html#g2095c2a797ae245521a7588b32279110">_dbus_string_equal_substring</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a>  *a,
<a name="l02105"></a>02105                               <span class="keywordtype">int</span>                a_start,
<a name="l02106"></a>02106                               <span class="keywordtype">int</span>                a_len,
<a name="l02107"></a>02107                               <span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a>  *b,
<a name="l02108"></a>02108                               <span class="keywordtype">int</span>                b_start)
<a name="l02109"></a>02109 {
<a name="l02110"></a>02110   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ap;
<a name="l02111"></a>02111   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *bp;
<a name="l02112"></a>02112   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *a_end;
<a name="l02113"></a>02113   <span class="keyword">const</span> <a class="code" href="structDBusRealString.html">DBusRealString</a> *real_a = (<span class="keyword">const</span> <a class="code" href="structDBusRealString.html">DBusRealString</a>*) a;
<a name="l02114"></a>02114   <span class="keyword">const</span> <a class="code" href="structDBusRealString.html">DBusRealString</a> *real_b = (<span class="keyword">const</span> <a class="code" href="structDBusRealString.html">DBusRealString</a>*) b;
<a name="l02115"></a>02115   <a class="code" href="group__DBusStringInternals.html#g862cb88a139179981e1fcd5643165b56">DBUS_GENERIC_STRING_PREAMBLE</a> (real_a);
<a name="l02116"></a>02116   <a class="code" href="group__DBusStringInternals.html#g862cb88a139179981e1fcd5643165b56">DBUS_GENERIC_STRING_PREAMBLE</a> (real_b);
<a name="l02117"></a>02117   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (a_start &gt;= 0);
<a name="l02118"></a>02118   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (a_len &gt;= 0);
<a name="l02119"></a>02119   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (a_start &lt;= real_a-&gt;len);
<a name="l02120"></a>02120   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (a_len &lt;= real_a-&gt;len - a_start);
<a name="l02121"></a>02121   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (b_start &gt;= 0);
<a name="l02122"></a>02122   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (b_start &lt;= real_b-&gt;len);
<a name="l02123"></a>02123   
<a name="l02124"></a>02124   <span class="keywordflow">if</span> (a_len &gt; real_b-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> - b_start)
<a name="l02125"></a>02125     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02126"></a>02126 
<a name="l02127"></a>02127   ap = real_a-&gt;str + a_start;
<a name="l02128"></a>02128   bp = real_b-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> + b_start;
<a name="l02129"></a>02129   a_end = ap + a_len;
<a name="l02130"></a>02130   <span class="keywordflow">while</span> (ap != a_end)
<a name="l02131"></a>02131     {
<a name="l02132"></a>02132       <span class="keywordflow">if</span> (*ap != *bp)
<a name="l02133"></a>02133         <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02134"></a>02134       
<a name="l02135"></a>02135       ++ap;
<a name="l02136"></a>02136       ++bp;
<a name="l02137"></a>02137     }
<a name="l02138"></a>02138 
<a name="l02139"></a>02139   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (bp &lt;= (real_b-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> + real_b-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a>));
<a name="l02140"></a>02140   
<a name="l02141"></a>02141   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02142"></a>02142 }
<a name="l02143"></a>02143 
<a name="l02151"></a>02151 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l02152"></a><a class="code" href="group__DBusString.html#g84f39f1bf398697920637d2982248c72">02152</a> <a class="code" href="group__DBusString.html#g84f39f1bf398697920637d2982248c72">_dbus_string_equal_c_str</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *a,
<a name="l02153"></a>02153                           <span class="keyword">const</span> <span class="keywordtype">char</span>       *c_str)
<a name="l02154"></a>02154 {
<a name="l02155"></a>02155   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ap;
<a name="l02156"></a>02156   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *bp;
<a name="l02157"></a>02157   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *a_end;
<a name="l02158"></a>02158   <span class="keyword">const</span> <a class="code" href="structDBusRealString.html">DBusRealString</a> *real_a = (<span class="keyword">const</span> <a class="code" href="structDBusRealString.html">DBusRealString</a>*) a;
<a name="l02159"></a>02159   <a class="code" href="group__DBusStringInternals.html#g862cb88a139179981e1fcd5643165b56">DBUS_GENERIC_STRING_PREAMBLE</a> (real_a);
<a name="l02160"></a>02160   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (c_str != <a class="code" href="group__DBusMacros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02161"></a>02161   
<a name="l02162"></a>02162   ap = real_a-&gt;str;
<a name="l02163"></a>02163   bp = (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) c_str;
<a name="l02164"></a>02164   a_end = real_a-&gt;str + real_a-&gt;len;
<a name="l02165"></a>02165   <span class="keywordflow">while</span> (ap != a_end &amp;&amp; *bp)
<a name="l02166"></a>02166     {
<a name="l02167"></a>02167       <span class="keywordflow">if</span> (*ap != *bp)
<a name="l02168"></a>02168         <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02169"></a>02169       
<a name="l02170"></a>02170       ++ap;
<a name="l02171"></a>02171       ++bp;
<a name="l02172"></a>02172     }
<a name="l02173"></a>02173 
<a name="l02174"></a>02174   <span class="keywordflow">if</span> (ap != a_end || *bp)
<a name="l02175"></a>02175     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02176"></a>02176   
<a name="l02177"></a>02177   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02178"></a>02178 }
<a name="l02179"></a>02179 
<a name="l02187"></a>02187 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l02188"></a><a class="code" href="group__DBusString.html#g4763d06a65cca36986bff030b404c90d">02188</a> <a class="code" href="group__DBusString.html#g4763d06a65cca36986bff030b404c90d">_dbus_string_starts_with_c_str</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *a,
<a name="l02189"></a>02189                                 <span class="keyword">const</span> <span class="keywordtype">char</span>       *c_str)
<a name="l02190"></a>02190 {
<a name="l02191"></a>02191   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ap;
<a name="l02192"></a>02192   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *bp;
<a name="l02193"></a>02193   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *a_end;
<a name="l02194"></a>02194   <span class="keyword">const</span> <a class="code" href="structDBusRealString.html">DBusRealString</a> *real_a = (<span class="keyword">const</span> <a class="code" href="structDBusRealString.html">DBusRealString</a>*) a;
<a name="l02195"></a>02195   <a class="code" href="group__DBusStringInternals.html#g862cb88a139179981e1fcd5643165b56">DBUS_GENERIC_STRING_PREAMBLE</a> (real_a);
<a name="l02196"></a>02196   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (c_str != <a class="code" href="group__DBusMacros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02197"></a>02197   
<a name="l02198"></a>02198   ap = real_a-&gt;str;
<a name="l02199"></a>02199   bp = (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) c_str;
<a name="l02200"></a>02200   a_end = real_a-&gt;str + real_a-&gt;len;
<a name="l02201"></a>02201   <span class="keywordflow">while</span> (ap != a_end &amp;&amp; *bp)
<a name="l02202"></a>02202     {
<a name="l02203"></a>02203       <span class="keywordflow">if</span> (*ap != *bp)
<a name="l02204"></a>02204         <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02205"></a>02205       
<a name="l02206"></a>02206       ++ap;
<a name="l02207"></a>02207       ++bp;
<a name="l02208"></a>02208     }
<a name="l02209"></a>02209 
<a name="l02210"></a>02210   <span class="keywordflow">if</span> (*bp == <span class="charliteral">'\0'</span>)
<a name="l02211"></a>02211     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02212"></a>02212   <span class="keywordflow">else</span>
<a name="l02213"></a>02213     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02214"></a>02214 }
<a name="l02215"></a>02215 
<a name="l02224"></a>02224 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l02225"></a><a class="code" href="group__DBusString.html#ge99a331d4e5b7758652b78dc9c89de84">02225</a> <a class="code" href="group__DBusString.html#ge99a331d4e5b7758652b78dc9c89de84">_dbus_string_append_byte_as_hex</a> (<a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l02226"></a>02226                                  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> byte)
<a name="l02227"></a>02227 {
<a name="l02228"></a>02228   <span class="keyword">const</span> <span class="keywordtype">char</span> hexdigits[16] = {
<a name="l02229"></a>02229     <span class="charliteral">'0'</span>, <span class="charliteral">'1'</span>, <span class="charliteral">'2'</span>, <span class="charliteral">'3'</span>, <span class="charliteral">'4'</span>, <span class="charliteral">'5'</span>, <span class="charliteral">'6'</span>, <span class="charliteral">'7'</span>, <span class="charliteral">'8'</span>, <span class="charliteral">'9'</span>,
<a name="l02230"></a>02230     <span class="charliteral">'a'</span>, <span class="charliteral">'b'</span>, <span class="charliteral">'c'</span>, <span class="charliteral">'d'</span>, <span class="charliteral">'e'</span>, <span class="charliteral">'f'</span>
<a name="l02231"></a>02231   };
<a name="l02232"></a>02232 
<a name="l02233"></a>02233   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#ga6ecf36e70263659f921a4ef0335db12">_dbus_string_append_byte</a> (str,
<a name="l02234"></a>02234                                  hexdigits[(byte &gt;&gt; 4)]))
<a name="l02235"></a>02235     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02236"></a>02236   
<a name="l02237"></a>02237   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#ga6ecf36e70263659f921a4ef0335db12">_dbus_string_append_byte</a> (str,
<a name="l02238"></a>02238                                  hexdigits[(byte &amp; 0x0f)]))
<a name="l02239"></a>02239     {
<a name="l02240"></a>02240       <a class="code" href="group__DBusString.html#g08c423b93c28dd746dcb93e0461ab95c">_dbus_string_set_length</a> (str,
<a name="l02241"></a>02241                                _dbus_string_get_length (str) - 1);
<a name="l02242"></a>02242       <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02243"></a>02243     }
<a name="l02244"></a>02244 
<a name="l02245"></a>02245   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02246"></a>02246 }
<a name="l02247"></a>02247 
<a name="l02258"></a>02258 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l02259"></a><a class="code" href="group__DBusString.html#gabb4873f436e015944a33cd1e3815cc9">02259</a> <a class="code" href="group__DBusString.html#gabb4873f436e015944a33cd1e3815cc9">_dbus_string_hex_encode</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *source,
<a name="l02260"></a>02260                          <span class="keywordtype">int</span>               start,
<a name="l02261"></a>02261                          <a class="code" href="structDBusString.html">DBusString</a>       *dest,
<a name="l02262"></a>02262                          <span class="keywordtype">int</span>               insert_at)
<a name="l02263"></a>02263 {
<a name="l02264"></a>02264   <a class="code" href="structDBusString.html">DBusString</a> result;
<a name="l02265"></a>02265   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p;
<a name="l02266"></a>02266   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end;
<a name="l02267"></a>02267   <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a> retval;
<a name="l02268"></a>02268   
<a name="l02269"></a>02269   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &lt;= _dbus_string_get_length (source));
<a name="l02270"></a>02270 
<a name="l02271"></a>02271   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#g348252317f7bb8ac43529972945830ae">_dbus_string_init</a> (&amp;result))
<a name="l02272"></a>02272     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02273"></a>02273 
<a name="l02274"></a>02274   retval = <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02275"></a>02275   
<a name="l02276"></a>02276   p = (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) _dbus_string_get_const_data (source);
<a name="l02277"></a>02277   end = p + _dbus_string_get_length (source);
<a name="l02278"></a>02278   p += start;
<a name="l02279"></a>02279   
<a name="l02280"></a>02280   <span class="keywordflow">while</span> (p != end)
<a name="l02281"></a>02281     {
<a name="l02282"></a>02282       <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#ge99a331d4e5b7758652b78dc9c89de84">_dbus_string_append_byte_as_hex</a> (&amp;result, *p))
<a name="l02283"></a>02283         <span class="keywordflow">goto</span> out;
<a name="l02284"></a>02284       
<a name="l02285"></a>02285       ++p;
<a name="l02286"></a>02286     }
<a name="l02287"></a>02287 
<a name="l02288"></a>02288   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#gd379fce8d4ef4f7e28f81f50b46ee4c9">_dbus_string_move</a> (&amp;result, 0, dest, insert_at))
<a name="l02289"></a>02289     <span class="keywordflow">goto</span> out;
<a name="l02290"></a>02290 
<a name="l02291"></a>02291   retval = <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02292"></a>02292 
<a name="l02293"></a>02293  out:
<a name="l02294"></a>02294   <a class="code" href="group__DBusString.html#g781ca91acda49a834dce7d0ed0eef212">_dbus_string_free</a> (&amp;result);
<a name="l02295"></a>02295   <span class="keywordflow">return</span> retval;
<a name="l02296"></a>02296 }
<a name="l02297"></a>02297 
<a name="l02308"></a>02308 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l02309"></a><a class="code" href="group__DBusString.html#g0a8c20d855f9ddc05718b9e2ac0e33d8">02309</a> <a class="code" href="group__DBusString.html#g0a8c20d855f9ddc05718b9e2ac0e33d8">_dbus_string_hex_decode</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *source,
<a name="l02310"></a>02310                          <span class="keywordtype">int</span>               start,
<a name="l02311"></a>02311                          <span class="keywordtype">int</span>              *end_return,
<a name="l02312"></a>02312                          <a class="code" href="structDBusString.html">DBusString</a>       *dest,
<a name="l02313"></a>02313                          <span class="keywordtype">int</span>               insert_at)
<a name="l02314"></a>02314 {
<a name="l02315"></a>02315   <a class="code" href="structDBusString.html">DBusString</a> result;
<a name="l02316"></a>02316   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p;
<a name="l02317"></a>02317   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end;
<a name="l02318"></a>02318   <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a> retval;
<a name="l02319"></a>02319   <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a> high_bits;
<a name="l02320"></a>02320   
<a name="l02321"></a>02321   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &lt;= _dbus_string_get_length (source));
<a name="l02322"></a>02322 
<a name="l02323"></a>02323   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#g348252317f7bb8ac43529972945830ae">_dbus_string_init</a> (&amp;result))
<a name="l02324"></a>02324     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02325"></a>02325 
<a name="l02326"></a>02326   retval = <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02327"></a>02327 
<a name="l02328"></a>02328   high_bits = <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02329"></a>02329   p = (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) _dbus_string_get_const_data (source);
<a name="l02330"></a>02330   end = p + _dbus_string_get_length (source);
<a name="l02331"></a>02331   p += start;
<a name="l02332"></a>02332   
<a name="l02333"></a>02333   <span class="keywordflow">while</span> (p != end)
<a name="l02334"></a>02334     {
<a name="l02335"></a>02335       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> val;
<a name="l02336"></a>02336 
<a name="l02337"></a>02337       <span class="keywordflow">switch</span> (*p)
<a name="l02338"></a>02338         {
<a name="l02339"></a>02339         <span class="keywordflow">case</span> <span class="charliteral">'0'</span>:
<a name="l02340"></a>02340           val = 0;
<a name="l02341"></a>02341           <span class="keywordflow">break</span>;
<a name="l02342"></a>02342         <span class="keywordflow">case</span> <span class="charliteral">'1'</span>:
<a name="l02343"></a>02343           val = 1;
<a name="l02344"></a>02344           <span class="keywordflow">break</span>;
<a name="l02345"></a>02345         <span class="keywordflow">case</span> <span class="charliteral">'2'</span>:
<a name="l02346"></a>02346           val = 2;
<a name="l02347"></a>02347           <span class="keywordflow">break</span>;
<a name="l02348"></a>02348         <span class="keywordflow">case</span> <span class="charliteral">'3'</span>:
<a name="l02349"></a>02349           val = 3;
<a name="l02350"></a>02350           <span class="keywordflow">break</span>;
<a name="l02351"></a>02351         <span class="keywordflow">case</span> <span class="charliteral">'4'</span>:
<a name="l02352"></a>02352           val = 4;
<a name="l02353"></a>02353           <span class="keywordflow">break</span>;
<a name="l02354"></a>02354         <span class="keywordflow">case</span> <span class="charliteral">'5'</span>:
<a name="l02355"></a>02355           val = 5;
<a name="l02356"></a>02356           <span class="keywordflow">break</span>;
<a name="l02357"></a>02357         <span class="keywordflow">case</span> <span class="charliteral">'6'</span>:
<a name="l02358"></a>02358           val = 6;
<a name="l02359"></a>02359           <span class="keywordflow">break</span>;
<a name="l02360"></a>02360         <span class="keywordflow">case</span> <span class="charliteral">'7'</span>:
<a name="l02361"></a>02361           val = 7;
<a name="l02362"></a>02362           <span class="keywordflow">break</span>;
<a name="l02363"></a>02363         <span class="keywordflow">case</span> <span class="charliteral">'8'</span>:
<a name="l02364"></a>02364           val = 8;
<a name="l02365"></a>02365           <span class="keywordflow">break</span>;
<a name="l02366"></a>02366         <span class="keywordflow">case</span> <span class="charliteral">'9'</span>:
<a name="l02367"></a>02367           val = 9;
<a name="l02368"></a>02368           <span class="keywordflow">break</span>;
<a name="l02369"></a>02369         <span class="keywordflow">case</span> <span class="charliteral">'a'</span>:
<a name="l02370"></a>02370         <span class="keywordflow">case</span> <span class="charliteral">'A'</span>:
<a name="l02371"></a>02371           val = 10;
<a name="l02372"></a>02372           <span class="keywordflow">break</span>;
<a name="l02373"></a>02373         <span class="keywordflow">case</span> <span class="charliteral">'b'</span>:
<a name="l02374"></a>02374         <span class="keywordflow">case</span> <span class="charliteral">'B'</span>:
<a name="l02375"></a>02375           val = 11;
<a name="l02376"></a>02376           <span class="keywordflow">break</span>;
<a name="l02377"></a>02377         <span class="keywordflow">case</span> <span class="charliteral">'c'</span>:
<a name="l02378"></a>02378         <span class="keywordflow">case</span> <span class="charliteral">'C'</span>:
<a name="l02379"></a>02379           val = 12;
<a name="l02380"></a>02380           <span class="keywordflow">break</span>;
<a name="l02381"></a>02381         <span class="keywordflow">case</span> <span class="charliteral">'d'</span>:
<a name="l02382"></a>02382         <span class="keywordflow">case</span> <span class="charliteral">'D'</span>:
<a name="l02383"></a>02383           val = 13;
<a name="l02384"></a>02384           <span class="keywordflow">break</span>;
<a name="l02385"></a>02385         <span class="keywordflow">case</span> <span class="charliteral">'e'</span>:
<a name="l02386"></a>02386         <span class="keywordflow">case</span> <span class="charliteral">'E'</span>:
<a name="l02387"></a>02387           val = 14;
<a name="l02388"></a>02388           <span class="keywordflow">break</span>;
<a name="l02389"></a>02389         <span class="keywordflow">case</span> <span class="charliteral">'f'</span>:
<a name="l02390"></a>02390         <span class="keywordflow">case</span> <span class="charliteral">'F'</span>:
<a name="l02391"></a>02391           val = 15;
<a name="l02392"></a>02392           <span class="keywordflow">break</span>;
<a name="l02393"></a>02393         <span class="keywordflow">default</span>:
<a name="l02394"></a>02394           <span class="keywordflow">goto</span> done;
<a name="l02395"></a>02395         }
<a name="l02396"></a>02396 
<a name="l02397"></a>02397       <span class="keywordflow">if</span> (high_bits)
<a name="l02398"></a>02398         {
<a name="l02399"></a>02399           <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#ga6ecf36e70263659f921a4ef0335db12">_dbus_string_append_byte</a> (&amp;result,
<a name="l02400"></a>02400                                          val &lt;&lt; 4))
<a name="l02401"></a>02401             <span class="keywordflow">goto</span> out;
<a name="l02402"></a>02402         }
<a name="l02403"></a>02403       <span class="keywordflow">else</span>
<a name="l02404"></a>02404         {
<a name="l02405"></a>02405           <span class="keywordtype">int</span> len;
<a name="l02406"></a>02406           <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> b;
<a name="l02407"></a>02407 
<a name="l02408"></a>02408           len = _dbus_string_get_length (&amp;result);
<a name="l02409"></a>02409           
<a name="l02410"></a>02410           b = _dbus_string_get_byte (&amp;result, len - 1);
<a name="l02411"></a>02411 
<a name="l02412"></a>02412           b |= val;
<a name="l02413"></a>02413 
<a name="l02414"></a>02414           _dbus_string_set_byte (&amp;result, len - 1, b);
<a name="l02415"></a>02415         }
<a name="l02416"></a>02416 
<a name="l02417"></a>02417       high_bits = !high_bits;
<a name="l02418"></a>02418 
<a name="l02419"></a>02419       ++p;
<a name="l02420"></a>02420     }
<a name="l02421"></a>02421 
<a name="l02422"></a>02422  done:
<a name="l02423"></a>02423   <span class="keywordflow">if</span> (!<a class="code" href="group__DBusString.html#gd379fce8d4ef4f7e28f81f50b46ee4c9">_dbus_string_move</a> (&amp;result, 0, dest, insert_at))
<a name="l02424"></a>02424     <span class="keywordflow">goto</span> out;
<a name="l02425"></a>02425 
<a name="l02426"></a>02426   <span class="keywordflow">if</span> (end_return)
<a name="l02427"></a>02427     *end_return = p - (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) _dbus_string_get_const_data (source);
<a name="l02428"></a>02428 
<a name="l02429"></a>02429   retval = <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02430"></a>02430   
<a name="l02431"></a>02431  out:
<a name="l02432"></a>02432   <a class="code" href="group__DBusString.html#g781ca91acda49a834dce7d0ed0eef212">_dbus_string_free</a> (&amp;result);  
<a name="l02433"></a>02433   <span class="keywordflow">return</span> retval;
<a name="l02434"></a>02434 }
<a name="l02435"></a>02435 
<a name="l02449"></a>02449 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l02450"></a><a class="code" href="group__DBusString.html#ga4324cd667e21beb31a5481cb0c12b6d">02450</a> <a class="code" href="group__DBusString.html#ga4324cd667e21beb31a5481cb0c12b6d">_dbus_string_validate_ascii</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l02451"></a>02451                              <span class="keywordtype">int</span>               start,
<a name="l02452"></a>02452                              <span class="keywordtype">int</span>               len)
<a name="l02453"></a>02453 {
<a name="l02454"></a>02454   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *s;
<a name="l02455"></a>02455   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end;
<a name="l02456"></a>02456   <a class="code" href="group__DBusStringInternals.html#g5cf5f12f6d8f839e9a7c3ad790a83316">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l02457"></a>02457   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &gt;= 0);
<a name="l02458"></a>02458   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &lt;= real-&gt;len);
<a name="l02459"></a>02459   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &gt;= 0);
<a name="l02460"></a>02460   
<a name="l02461"></a>02461   <span class="keywordflow">if</span> (len &gt; real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> - start)
<a name="l02462"></a>02462     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02463"></a>02463   
<a name="l02464"></a>02464   s = real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> + start;
<a name="l02465"></a>02465   end = s + len;
<a name="l02466"></a>02466   <span class="keywordflow">while</span> (s != end)
<a name="l02467"></a>02467     {
<a name="l02468"></a>02468       <span class="keywordflow">if</span> (_DBUS_UNLIKELY (!_DBUS_ISASCII (*s)))
<a name="l02469"></a>02469         <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02470"></a>02470         
<a name="l02471"></a>02471       ++s;
<a name="l02472"></a>02472     }
<a name="l02473"></a>02473   
<a name="l02474"></a>02474   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02475"></a>02475 }
<a name="l02476"></a>02476 
<a name="l02484"></a>02484 <span class="keywordtype">void</span>
<a name="l02485"></a><a class="code" href="group__DBusString.html#g698f4b0299e6c6a707fd7e9c14915f00">02485</a> <a class="code" href="group__DBusString.html#g698f4b0299e6c6a707fd7e9c14915f00">_dbus_string_tolower_ascii</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l02486"></a>02486                             <span class="keywordtype">int</span>               start,
<a name="l02487"></a>02487                             <span class="keywordtype">int</span>               len)
<a name="l02488"></a>02488 {
<a name="l02489"></a>02489   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *s;
<a name="l02490"></a>02490   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end;
<a name="l02491"></a>02491   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l02492"></a>02492   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &gt;= 0);
<a name="l02493"></a>02493   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &lt;= real-&gt;len);
<a name="l02494"></a>02494   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &gt;= 0);
<a name="l02495"></a>02495   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &lt;= real-&gt;len - start);
<a name="l02496"></a>02496 
<a name="l02497"></a>02497   s = real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> + start;
<a name="l02498"></a>02498   end = s + len;
<a name="l02499"></a>02499 
<a name="l02500"></a>02500   <span class="keywordflow">while</span> (s != end)
<a name="l02501"></a>02501     {
<a name="l02502"></a>02502       <span class="keywordflow">if</span> (*s &gt;= <span class="charliteral">'A'</span> &amp;&amp; *s &lt;= <span class="charliteral">'Z'</span>)
<a name="l02503"></a>02503           *s += <span class="charliteral">'a'</span> - <span class="charliteral">'A'</span>;
<a name="l02504"></a>02504       ++s;
<a name="l02505"></a>02505     }
<a name="l02506"></a>02506 }
<a name="l02507"></a>02507 
<a name="l02515"></a>02515 <span class="keywordtype">void</span>
<a name="l02516"></a><a class="code" href="group__DBusString.html#g9c959f7d18ff21c5ae51846c6ba065f1">02516</a> <a class="code" href="group__DBusString.html#g9c959f7d18ff21c5ae51846c6ba065f1">_dbus_string_toupper_ascii</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l02517"></a>02517                             <span class="keywordtype">int</span>               start,
<a name="l02518"></a>02518                             <span class="keywordtype">int</span>               len)
<a name="l02519"></a>02519 {
<a name="l02520"></a>02520   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *s;
<a name="l02521"></a>02521   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end;
<a name="l02522"></a>02522   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l02523"></a>02523   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &gt;= 0);
<a name="l02524"></a>02524   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &lt;= real-&gt;len);
<a name="l02525"></a>02525   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &gt;= 0);
<a name="l02526"></a>02526   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &lt;= real-&gt;len - start);
<a name="l02527"></a>02527 
<a name="l02528"></a>02528   s = real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> + start;
<a name="l02529"></a>02529   end = s + len;
<a name="l02530"></a>02530 
<a name="l02531"></a>02531   <span class="keywordflow">while</span> (s != end)
<a name="l02532"></a>02532     {
<a name="l02533"></a>02533       <span class="keywordflow">if</span> (*s &gt;= <span class="charliteral">'a'</span> &amp;&amp; *s &lt;= <span class="charliteral">'z'</span>)
<a name="l02534"></a>02534           *s += <span class="charliteral">'A'</span> - <span class="charliteral">'a'</span>;
<a name="l02535"></a>02535       ++s;
<a name="l02536"></a>02536     }
<a name="l02537"></a>02537 }
<a name="l02538"></a>02538 
<a name="l02554"></a>02554 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l02555"></a><a class="code" href="group__DBusString.html#g65f0f04b7c9371406fc87343f691e8da">02555</a> <a class="code" href="group__DBusString.html#g65f0f04b7c9371406fc87343f691e8da">_dbus_string_validate_utf8</a>  (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l02556"></a>02556                              <span class="keywordtype">int</span>               start,
<a name="l02557"></a>02557                              <span class="keywordtype">int</span>               len)
<a name="l02558"></a>02558 {
<a name="l02559"></a>02559   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p;
<a name="l02560"></a>02560   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end;
<a name="l02561"></a>02561   <a class="code" href="group__DBusStringInternals.html#g5cf5f12f6d8f839e9a7c3ad790a83316">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l02562"></a>02562   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &gt;= 0);
<a name="l02563"></a>02563   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &lt;= real-&gt;len);
<a name="l02564"></a>02564   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &gt;= 0);
<a name="l02565"></a>02565 
<a name="l02566"></a>02566   <span class="comment">/* we are doing _DBUS_UNLIKELY() here which might be</span>
<a name="l02567"></a>02567 <span class="comment">   * dubious in a generic library like GLib, but in D-Bus</span>
<a name="l02568"></a>02568 <span class="comment">   * we know we're validating messages and that it would</span>
<a name="l02569"></a>02569 <span class="comment">   * only be evil/broken apps that would have invalid</span>
<a name="l02570"></a>02570 <span class="comment">   * UTF-8. Also, this function seems to be a performance</span>
<a name="l02571"></a>02571 <span class="comment">   * bottleneck in profiles.</span>
<a name="l02572"></a>02572 <span class="comment">   */</span>
<a name="l02573"></a>02573   
<a name="l02574"></a>02574   <span class="keywordflow">if</span> (_DBUS_UNLIKELY (len &gt; real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> - start))
<a name="l02575"></a>02575     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02576"></a>02576   
<a name="l02577"></a>02577   p = real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> + start;
<a name="l02578"></a>02578   end = p + len;
<a name="l02579"></a>02579   
<a name="l02580"></a>02580   <span class="keywordflow">while</span> (p &lt; end)
<a name="l02581"></a>02581     {
<a name="l02582"></a>02582       <span class="keywordtype">int</span> i, mask, char_len;
<a name="l02583"></a>02583       dbus_unichar_t result;
<a name="l02584"></a>02584 
<a name="l02585"></a>02585       <span class="comment">/* nul bytes considered invalid */</span>
<a name="l02586"></a>02586       <span class="keywordflow">if</span> (*p == <span class="charliteral">'\0'</span>)
<a name="l02587"></a>02587         <span class="keywordflow">break</span>;
<a name="l02588"></a>02588       
<a name="l02589"></a>02589       <span class="comment">/* Special-case ASCII; this makes us go a lot faster in</span>
<a name="l02590"></a>02590 <span class="comment">       * D-Bus profiles where we are typically validating</span>
<a name="l02591"></a>02591 <span class="comment">       * function names and such. We have to know that</span>
<a name="l02592"></a>02592 <span class="comment">       * all following checks will pass for ASCII though,</span>
<a name="l02593"></a>02593 <span class="comment">       * comments follow ...</span>
<a name="l02594"></a>02594 <span class="comment">       */</span>      
<a name="l02595"></a>02595       <span class="keywordflow">if</span> (*p &lt; 128)
<a name="l02596"></a>02596         {
<a name="l02597"></a>02597           ++p;
<a name="l02598"></a>02598           <span class="keywordflow">continue</span>;
<a name="l02599"></a>02599         }
<a name="l02600"></a>02600       
<a name="l02601"></a>02601       <a class="code" href="group__DBusString.html#g30614080229a4fb63460ffdc8ab484fb">UTF8_COMPUTE</a> (*p, mask, char_len);
<a name="l02602"></a>02602 
<a name="l02603"></a>02603       <span class="keywordflow">if</span> (_DBUS_UNLIKELY (char_len == 0))  <span class="comment">/* ASCII: char_len == 1 */</span>
<a name="l02604"></a>02604         <span class="keywordflow">break</span>;
<a name="l02605"></a>02605 
<a name="l02606"></a>02606       <span class="comment">/* check that the expected number of bytes exists in the remaining length */</span>
<a name="l02607"></a>02607       <span class="keywordflow">if</span> (_DBUS_UNLIKELY ((end - p) &lt; char_len)) <span class="comment">/* ASCII: p &lt; end and char_len == 1 */</span>
<a name="l02608"></a>02608         <span class="keywordflow">break</span>;
<a name="l02609"></a>02609         
<a name="l02610"></a>02610       <a class="code" href="group__DBusString.html#gb5b4b316a69f78611a14e6b1fd091992">UTF8_GET</a> (result, p, i, mask, char_len);
<a name="l02611"></a>02611 
<a name="l02612"></a>02612       <span class="comment">/* Check for overlong UTF-8 */</span>
<a name="l02613"></a>02613       <span class="keywordflow">if</span> (_DBUS_UNLIKELY (<a class="code" href="group__DBusString.html#g9691ff5386e218870299de1d9e77ceea">UTF8_LENGTH</a> (result) != char_len)) <span class="comment">/* ASCII: UTF8_LENGTH == 1 */</span>
<a name="l02614"></a>02614         <span class="keywordflow">break</span>;
<a name="l02615"></a>02615 <span class="preprocessor">#if 0</span>
<a name="l02616"></a>02616 <span class="preprocessor"></span>      <span class="comment">/* The UNICODE_VALID check below will catch this */</span>
<a name="l02617"></a>02617       <span class="keywordflow">if</span> (_DBUS_UNLIKELY (result == (dbus_unichar_t)-1)) <span class="comment">/* ASCII: result = ascii value */</span>
<a name="l02618"></a>02618         <span class="keywordflow">break</span>;
<a name="l02619"></a>02619 <span class="preprocessor">#endif</span>
<a name="l02620"></a>02620 <span class="preprocessor"></span>
<a name="l02621"></a>02621       <span class="keywordflow">if</span> (_DBUS_UNLIKELY (!<a class="code" href="group__DBusString.html#g25f0a93fc023fa0eec07ac1e32011e89">UNICODE_VALID</a> (result))) <span class="comment">/* ASCII: always valid */</span>
<a name="l02622"></a>02622         <span class="keywordflow">break</span>;
<a name="l02623"></a>02623 
<a name="l02624"></a>02624       <span class="comment">/* UNICODE_VALID should have caught it */</span>
<a name="l02625"></a>02625       <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (result != (dbus_unichar_t)-1);
<a name="l02626"></a>02626       
<a name="l02627"></a>02627       p += char_len;
<a name="l02628"></a>02628     }
<a name="l02629"></a>02629 
<a name="l02630"></a>02630   <span class="comment">/* See that we covered the entire length if a length was</span>
<a name="l02631"></a>02631 <span class="comment">   * passed in</span>
<a name="l02632"></a>02632 <span class="comment">   */</span>
<a name="l02633"></a>02633   <span class="keywordflow">if</span> (_DBUS_UNLIKELY (p != end))
<a name="l02634"></a>02634     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02635"></a>02635   <span class="keywordflow">else</span>
<a name="l02636"></a>02636     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02637"></a>02637 }
<a name="l02638"></a>02638 
<a name="l02652"></a>02652 <a class="code" href="group__DBusTypes.html#g39c9cb0f3a2a8ad6f55cc4855d035349">dbus_bool_t</a>
<a name="l02653"></a><a class="code" href="group__DBusString.html#g199d0fc00ee3cd0300a1b3870d7986a3">02653</a> <a class="code" href="group__DBusString.html#g199d0fc00ee3cd0300a1b3870d7986a3">_dbus_string_validate_nul</a> (<span class="keyword">const</span> <a class="code" href="structDBusString.html">DBusString</a> *str,
<a name="l02654"></a>02654                            <span class="keywordtype">int</span>               start,
<a name="l02655"></a>02655                            <span class="keywordtype">int</span>               len)
<a name="l02656"></a>02656 {
<a name="l02657"></a>02657   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *s;
<a name="l02658"></a>02658   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *end;
<a name="l02659"></a>02659   <a class="code" href="group__DBusStringInternals.html#g5cf5f12f6d8f839e9a7c3ad790a83316">DBUS_CONST_STRING_PREAMBLE</a> (str);
<a name="l02660"></a>02660   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &gt;= 0);
<a name="l02661"></a>02661   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (len &gt;= 0);
<a name="l02662"></a>02662   <a class="code" href="group__DBusInternalsUtils.html#g129c6c03f011cdc171934d5d386cc797">_dbus_assert</a> (start &lt;= real-&gt;len);
<a name="l02663"></a>02663   
<a name="l02664"></a>02664   <span class="keywordflow">if</span> (len &gt; real-&gt;<a class="code" href="structDBusRealString.html#ed6f543f7b748c4f5cf92b9aedd5f68d">len</a> - start)
<a name="l02665"></a>02665     <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02666"></a>02666   
<a name="l02667"></a>02667   s = real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> + start;
<a name="l02668"></a>02668   end = s + len;
<a name="l02669"></a>02669   <span class="keywordflow">while</span> (s != end)
<a name="l02670"></a>02670     {
<a name="l02671"></a>02671       <span class="keywordflow">if</span> (_DBUS_UNLIKELY (*s != <span class="charliteral">'\0'</span>))
<a name="l02672"></a>02672         <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02673"></a>02673       ++s;
<a name="l02674"></a>02674     }
<a name="l02675"></a>02675   
<a name="l02676"></a>02676   <span class="keywordflow">return</span> <a class="code" href="group__DBusMacros.html#ga8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02677"></a>02677 }
<a name="l02678"></a>02678 
<a name="l02684"></a>02684 <span class="keywordtype">void</span>
<a name="l02685"></a><a class="code" href="group__DBusString.html#g9385fd0de31b3f5f4f8baa96bad3fac6">02685</a> <a class="code" href="group__DBusString.html#g9385fd0de31b3f5f4f8baa96bad3fac6">_dbus_string_zero</a> (<a class="code" href="structDBusString.html">DBusString</a> *str)
<a name="l02686"></a>02686 {
<a name="l02687"></a>02687   <a class="code" href="group__DBusStringInternals.html#g376570af2af3ebb7e59d45b49b9582b3">DBUS_STRING_PREAMBLE</a> (str);
<a name="l02688"></a>02688 
<a name="l02689"></a>02689   memset (real-&gt;<a class="code" href="structDBusRealString.html#d60d27edba516b0a179ce1ead1e74725">str</a> - real-&gt;<a class="code" href="structDBusRealString.html#21fb373a65e36646787392a3dfe62443">align_offset</a>, <span class="charliteral">'\0'</span>, real-&gt;<a class="code" href="structDBusRealString.html#e12ec58c271e47f3f89fae1410b7c5e5">allocated</a>);
<a name="l02690"></a>02690 }
<a name="l02693"></a>02693 <span class="comment">/* tests are in dbus-string-util.c */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on 13 Sep 2016 for D-Bus by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
